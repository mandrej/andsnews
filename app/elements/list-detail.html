<link rel="import" href="elements.html">

<dom-module id="list-detail">
    <template>
        <style is="custom-style" include="shared-styles"></style>
        <style>
            :host {
                display: block;
                height: 100vh;
                @apply(--paper-font-common-base);
            }
            .swipe {
                -moz-user-select: none;
                -ms-user-select: none;
                -webkit-user-select: none;
                user-select: none;
                cursor: default;
            }
            .content { height: calc(100vh - 64px); }
            iron-image { width: 100%; height: 100%; }
        </style>

        <iron-swipeable-pages class="fit" selected="{{selected}}" edgeSwipeSensitivity="15" threshold="0.1">
            <template is="dom-repeat" items="{{items}}">
                <template is="dom-if" if="[[_showPhoto(item)]]">
                    <div class="swipe fit">
                        <app-header>
                            <app-toolbar>
                                <paper-icon-button icon="icons:chevron-left" on-tap="_showList"></paper-icon-button>
                                <div title>[[item.headline]]</div>
                                <paper-icon-button icon="icons:more-vert" on-tap="_showExif"></paper-icon-button>
                            </app-toolbar>
                        </app-header>

                        <div class="content">
                            <iron-image src="{{item.serving_url}}=s0" preload fade sizing="cover"></iron-image>

                            <paper-dialog id="[[item.slug]]" entry-animation="scale-up-animation" exit-animation="fade-out-animation">
                                <p>
                                    [[_dateFormat(item.date)]]<br>
                                    [[item.author]]<br><br>
                                    [[item.model]]<br>
                                    [[item.lens]]<br>
                                    [[item.eqv]] mm<br>
                                    [[item.iso]] ASA
                                </p>
                            </paper-dialog>
                        </div>
                    </div>
                </template>
                <template is="dom-if" if="[[!_showPhoto(item)]]">
                    <div class="swipe fit">
                        <app-header>
                            <app-toolbar>
                                <paper-icon-button icon="icons:chevron-left" on-tap="_showList"></paper-icon-button>
                                <div title>[[item.headline]]</div>
                            </app-toolbar>
                        </app-header>

                        <div class="content">
                            <paper-card elevation="0" animated-shadow="false">
                                <div class="card-content" style="padding: 16px">
                                    <!-- <div inner-h-t-m-l="[[item.body]]"></div> -->
                                    <template is="juicy-html" content$="[[item.body]]"></template>
                                </div>
                            </paper-card>
                        </div>
                    </div>
                </template>
            </template>
        </iron-swipeable-pages>
    </template>

    <script>
        Polymer({
            is: 'list-detail',
            behaviors: [
                Polymer.NeonAnimationRunnerBehavior
            ],
            properties: {
                animationConfig: {
                    type: Object,
                    value: function() {
                        return {
                            'entry': [{
                                name: 'slide-from-right-animation',
                                node: this,
                                timing: {
                                    delay: 50
                                }
                            }],
                            'exit': [{
                                name: 'slide-right-animation',
                                node: this
                            }]
                        }
                    }
                },
                selected: {
                    type: Number,
                    value: 0,
                    notify: true
                }
            },
            _showPhoto: function(item) {
                return item.kind == 'photo';
            },
            _dateFormat: function(value) {
                return moment(value, 'YYYY-MM-DDTHH:mm:ss').locale('sr').format('LLL');
                // return moment(value, 'YYYY-MM-DDTHH:mm:ss').locale('sr').fromNow();
            },
            _showList: function(e) {
                this.fire('toggle_view');
            },
            _showExif: function(e) {
                var id = e.model.item.slug,
                    dialog = document.getElementById(id);
                if (dialog) {
                    dialog.open();
                }
            }
        });
    </script>
    <script src="../bower_components/moment/min/moment-with-locales.min.js"></script>
</dom-module>
