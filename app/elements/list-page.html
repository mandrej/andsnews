<link rel="import" href="elements.html">
<link rel="import" href="list-filter.html">
<link rel="import" href="list-grid.html">
<link rel="import" href="list-detail.html">

<dom-module id="list-page">
	<template>
		<style is="custom-style" include="shared-styles"></style>
		<style>
			:host {
				display: block;
				@apply(--paper-font-common-base);
			}

			paper-input {
				--paper-input-container-input-color: var(--dark-theme-text-color);
			}
			paper-dialog {
				position: fixed;
				height: auto;
				left: 0;
				right: 0;
				bottom: 50px;
			}
		</style>

		<app-drawer-layout id="drawer">
			<app-drawer>
				<app-header fixed>
					<app-toolbar>
						<iron-icon icon="icons:search" style="margin-right: 16px"></iron-icon>
						<iron-a11y-keys target="[[targetSearch]]" keys="enter" on-keys-pressed="_onSearch"></iron-a11y-keys>
						<paper-input id="inputSearch" placeholder="search" no-label-float
						value="{{search::input}}"></paper-input>
					</app-toolbar>

					<app-toolbar>
						<paper-menu attr-for-selected="kind-page" selected="[[kind]]" class="fit">
							<paper-item kind-page="photo" on-tap="_kindChanged">
								<a href="#/photo" class="flex">
									<iron-icon icon="image:photo-camera"></iron-icon>Photos
								</a>
							</paper-item>
							<paper-item kind-page="entry" on-tap="_kindChanged">
								<a href="#/entry" class="flex">
									<iron-icon icon="icons:description"></iron-icon>Texts
								</a>
							</paper-item>

							<list-filter
								kind="[[kind]]"
								field="{{field}}"
								value="{{value}}"
								route="{{route}}"></list-filter>
						</paper-menu>
					</app-toolbar>
				</app-header>
			</app-drawer>

			<app-header-layout>
				<app-header fixed hidden$="{{toggleView}}">
					<app-toolbar>
						<paper-icon-button icon="icons:menu" drawer-toggle></paper-icon-button>
						<div title>ANDрејевићи {{kind}} {{field}} {{value}}</div>
						<paper-spinner active$="[[loading]]"></paper-spinner>
					</app-toolbar>
				</app-header>

				<iron-pages selected="grid" attr-for-selected="data-view" id="switch">
					<list-grid
						page="{{page}}"
						kind="{{kind}}"
						field="{{field}}"
			            value="{{value}}"
						route="{{route}}"
						data-view="grid"
						selected="{{selected}}"
						loading="{{loading}}"
						items="{{items}}"></list-grid>

					<list-detail
						page="{{page}}"
						kind="{{kind}}"
						field="{{field}}"
			            value="{{value}}"
						route="{{route}}"
						data-view="detail"
						selected="{{selected}}"
						loading="{{loading}}"
						items="{{items}}"></list-detail>
				</iron-pages>
			</app-header-layout>
		</app-drawer-layout>
	</template>

	<script>
		Polymer({
			is: 'list-page',
			properties: {
				items: {
					type: Array,
					value: [],
					notify: true
				},
				toggleView: {
					type: Boolean,
					value: false,
					notify: true
				},
				search: {
					type: String,
					notify: true
				},
				targetSearch: {
					type: Object,
					value: function() {
						return this.$.inputSearch
					}
				},
				loading: Boolean
			},
			observers: ['_kindChanged(kind)'],
			listeners: {
				'show-detail': '_toggleView',
				'show-grid': '_toggleView'
			},
			_kindChanged: function(kind) {
				if (kind != 'search') this.field = null;
				this.value = null;
				this.page = null;
				this.search = null;
				// this.items = [];
			},
			_toggleView: function(e) {
				var drawer = this.$.drawer;
				if (drawer.getBoundingClientRect().width > parseInt(drawer.responsiveWidth)) {
					drawer.forceNarrow = !drawer.forceNarrow;
				}
				this.toggleView = !this.toggleView;
				if (this.toggleView) {
					this.$.switch.selected = 'detail';
				} else {
					this.$.switch.selected = 'grid';
				}
			},
			_onSearch: function() {
				this.field = this.search;
				this.value = null;
				this.page = null;
				this.set('route.path', '/search/' + this.field);
			},
			propertyChanged: function(newValue, oldValue) {
				console.log([oldValue || 'undefined', ' -> ', newValue].join(''));
			},
			objectChanged: function(newValue, oldValue) {
				console.log(newValue);
			}
		});
	</script>
</dom-module>
