<dom-module id="filter-page">
    <template>
        <style is="custom-style" include="shared-styles"></style>
        <style>
            :host {
                display: block;
                background: #ccc;
            }
            .content { padding: 16px; }
            paper-button {
                color: white;
                font-size: 0.8em;
                background-color: var(--paper-grey-500);
                margin-bottom: 1em;
            }
            paper-button.selected {
                background-color: var(--paper-red-500);
            }
        </style>

        <iron-ajax auto
            url="{{_url(kind)}}"
            handle-as="json"
            last-response="{{response}}"
            debounce-duration="300">
        </iron-ajax>

        <template is="dom-repeat" items="[[response]]" as="row">
            <paper-item>
                <iron-icon icon="{{_whichIcon(row.field_name)}}"></iron-icon>
                <span>[[row.field_name]]</span>
            </<paper-item>

            <template is="dom-repeat" items="[[row.items]]" as="rec">
                <span class$="[[_check(rec.name, value)]]"
                    data-field$="[[row.field_name]]" on-tap="_showFilteredList">
                    [[rec.name]]
                </span>
            </template>
        </template>
    </template>

    <script>
        Polymer({
            is: 'filter-page',
            behaviors: [Polymer.NeonAnimatableBehavior],
            properties: {
                animationConfig: {
                    type: Object,
                    value: function() {
                        return {
                            'entry': {
                                name: 'slide-from-right-animation',
                                node: this
                            },
                            'exit': {
                                name: 'slide-right-animation',
                                node: this
                            }
                        }
                    }
                }
            },
            _url: function(kind) {
                var prefix = '/api/filter', sufix = kind;
                var url = [prefix, sufix].join('/');
                console.log(url);
                return url;
            },
            _whichIcon: function(field) {
                switch (field) {
                    case 'tags':
                        return 'icons:label';
                    case 'date':
                        return 'icons:date-range';
                    case 'author':
                        return 'social:person';
                }
            },
            _check: function(current, selected) {
                if (current == selected) return 'selected';
            },
            _showFilteredList: function(e) {
                var index_page = document.querySelector('index-page');

                index_page.set('data.kind', this.kind);
                index_page.set('dataFilter.field', e.model.row.field_name);
                index_page.set('dataFilter.value', e.model.rec.name);
                index_page.page = null;
                this.fire('show-list');
            },
            _showList: function() {
                var index_page = document.querySelector('index-page');

                index_page.set('data.kind', this.kind);
                index_page.set('dataFilter.field', '');
                index_page.set('dataFilter.value', '');
                index_page.page = null;
                this.fire('show-list');
            }
        })
    </script>
</dom-module>
