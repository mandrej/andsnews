<dom-module id="filter-page">
    <template>
        <style is="custom-style" include="shared-styles"></style>
        <style>
            :host {
                @apply(--layout-fullbleed);
                @apply(--paper-font-common-base);
                background: var(--primary-background-color);
            }
            .content { padding: 16px; }
            .badge {
                position: relative;
                display: inline-block;
                margin-right: 30px;
                margin-top: 20px;
                cursor: pointer;
            }
            .badge > paper-badge {
                top: -16px;
                right: -16px;
            }
        </style>

        <iron-ajax id="filter_ajax"
            auto
            url="{{url}}"
            handle-as="json"
            last-response="{{response}}"
            debounce-duration="300">
        </iron-ajax>

        <paper-drawer-panel>
			<paper-header-panel drawer>
				<paper-menu>
                    <a class="paper-item-link" kind-page="photo" href="#/photo/all/"><paper-item>Photos</paper-item></a>
					<a class="paper-item-link" kind-page="entry" href="#/entry/all/"><paper-item>Texts</paper-item></a>
                </paper-menu>
			</paper-header-panel>

            <paper-header-panel main>
                <paper-toolbar>
                    <paper-icon-button icon="icons:menu" paper-drawer-toggle></paper-icon-button>
                    <div class="title">ANDрејевићи</div>
                    <paper-icon-button icon="icons:done" on-tap="_showList"></paper-icon-button>
                </paper-toolbar>

                <div class="content">
                    <h2>[[response.field_name]]</h2>
                    <template is="dom-repeat" items="[[response.items]]">
                        <div on-tap="_showFilteredList" class="badge">
                            <div>[[item.name]]</div>
                            <paper-badge label="[[item.count]]"></paper-badge>
                        </div>
                    </template>
                </div>
            </paper-header-panel>
        </paper-drawer-panel>
    </template>

    <script>
        Polymer({
            is: 'filter-page',
            behaviors: [Polymer.NeonAnimatableBehavior],
            properties: {
                animationConfig: {
                    type: Object,
                    value: function() {
                        return {
                            'entry': {
                                name: 'slide-from-right-animation',
                                node: this
                            },
                            'exit': {
                                name: 'slide-right-animation',
                                node: this
                            }
                        }
                    }
                },
                url: {
                    computed: '_url(kind)',
                    notify: true
                }
            },
            _url: function(kind) {
                var prefix = 'filter', sufix = '';
                if (kind == 'photo') sufix = 'Photo_tags';
                if (kind == 'entry') sufix = 'Entry_tags';
                var url = [prefix, sufix].join('/');
                return url;
            },
            _showFilteredList: function(e) {
                var model = e.model,
                    index_page = document.querySelector('index-page'),
                    list_page = document.querySelector('list-page'),
                    list_ajax = document.querySelector('#list_ajax');

                index_page.set('data.kind', this.kind);
                index_page.set('dataFilter.field', this.$.filter_ajax.lastResponse.field_name);
                index_page.set('dataFilter.value', model.item.name);
                // index_page.set('route.path', ['', this.kind, this.$.filter_ajax.lastResponse.field_name, model.item.name].join('/'));

                list_page.page = null;
                list_page.clearItems = true;
                // list_page.fire('url-changed');
                this.fire('show-list');
            },
            _showList: function() {
                var index_page = document.querySelector('index-page'),
                    list_page = document.querySelector('list-page'),
                    list_ajax = document.querySelector('#list_ajax');

                index_page.set('data.kind', this.kind);
                index_page.set('dataFilter.field', '');
                index_page.set('dataFilter.value', '');

                list_page.page = null;
                list_page.clearItems = true;
                // list_page.fire('url-changed');
                this.fire('show-list');
            }
        })
    </script>
</dom-module>
