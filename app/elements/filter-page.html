<dom-module id="filter-page">
    <template>
        <style is="custom-style" include="shared-styles"></style>
        <style>
            :host {
                @apply(--layout-fullbleed);
                @apply(--paper-font-common-base);
                background: var(--primary-background-color);
            }
            .content { padding: 16px; }
            paper-button {
                color: white;
                font-size: 0.8em;
                background-color: var(--paper-grey-500);
                margin-bottom: 1em;
            }
            paper-button.selected {
                background-color: var(--paper-red-500);
            }
        </style>

        <iron-ajax auto
            url="{{_url(kind)}}"
            handle-as="json"
            last-response="{{response}}"
            debounce-duration="300">
        </iron-ajax>

        <paper-drawer-panel>
			<paper-header-panel drawer>
                <paper-menu attr-for-selected="kind-page" selected="{{data.kind}}">
					<a class="paper-item-link" kind-page="photo" href="#/photo">
						<paper-item>
							<iron-icon icon="image:photo-camera"></iron-icon>
							<span>Photos</span>
						</paper-item>
					</a>
					<a class="paper-item-link" kind-page="entry" href="#/entry">
						<paper-item>
							<iron-icon icon="icons:description"></iron-icon>
							<span>Texts</span>
						</paper-item>
					</a>
                </paper-menu>
			</paper-header-panel>

            <paper-header-panel main>
                <paper-toolbar>
                    <paper-icon-button icon="icons:menu" paper-drawer-toggle></paper-icon-button>
                    <div class="title">ANDрејевићи</div>
                    <paper-icon-button icon="icons:done" on-tap="_showList"></paper-icon-button>
                </paper-toolbar>

                <div class="content">
                    <template is="dom-repeat" items="[[response]]" as="row">
                        <h2>[[row.field_name]]</h2>
                        <template is="dom-repeat" items="[[row.items]]" as="rec">
                            <paper-button class$="[[_check(rec.name, value)]]"
                                data-field$="[[row.field_name]]" on-tap="_showFilteredList">
                                [[rec.name]] [[rec.count]]
                            </paper-button>
                        </template>
                    </template>
                </div>
            </paper-header-panel>
        </paper-drawer-panel>
    </template>

    <script>
        Polymer({
            is: 'filter-page',
            behaviors: [Polymer.NeonAnimatableBehavior],
            properties: {
                animationConfig: {
                    type: Object,
                    value: function() {
                        return {
                            'entry': {
                                name: 'slide-from-right-animation',
                                node: this
                            },
                            'exit': {
                                name: 'slide-right-animation',
                                node: this
                            }
                        }
                    }
                }
            },
            _url: function(kind) {
                var prefix = '/api/filter', sufix = kind;
                var url = [prefix, sufix].join('/');
                console.log(url);
                return url;
            },
            _check: function(current, selected) {
                if (current == selected) return 'selected';
            },
            _showFilteredList: function(e) {
                var index_page = document.querySelector('index-page');

                index_page.set('data.kind', this.kind);
                index_page.set('dataFilter.field', e.model.row.field_name);
                index_page.set('dataFilter.value', e.model.rec.name);
                index_page.page = null;
                this.fire('show-list');
            },
            _showList: function() {
                var index_page = document.querySelector('index-page');

                index_page.set('data.kind', this.kind);
                index_page.set('dataFilter.field', '');
                index_page.set('dataFilter.value', '');
                index_page.page = null;
                this.fire('show-list');
            }
        })
    </script>
</dom-module>
