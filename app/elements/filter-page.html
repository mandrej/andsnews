<dom-module id="filter-page">
    <template>
        <style is="custom-style" include="shared-styles"></style>
        <style>
            :host {
                @apply(--layout-fullbleed);
                @apply(--paper-font-common-base);
                background: var(--primary-background-color);
            }
            .content { padding: 16px; }
            paper-button {
                color: white;
                font-size: 0.8em;
                background-color: var(--paper-grey-500);
                margin-bottom: 1em;
            }
            paper-button.selected {
                background-color: var(--paper-red-500);
            }
        </style>

        <iron-ajax auto
            url="{{_tags_url(kind)}}"
            handle-as="json"
            last-response="{{tags_response}}"
            debounce-duration="300">
        </iron-ajax>

        <iron-ajax auto
            url="{{_date_url(kind)}}"
            handle-as="json"
            last-response="{{date_response}}"
            debounce-duration="300">
        </iron-ajax>

        <paper-drawer-panel>
			<paper-header-panel drawer>
				<paper-menu>
                    <a class="paper-item-link" kind-page="photo" href="#/photo/all/"><paper-item>Photos</paper-item></a>
					<a class="paper-item-link" kind-page="entry" href="#/entry/all/"><paper-item>Texts</paper-item></a>
                </paper-menu>
			</paper-header-panel>

            <paper-header-panel main>
                <paper-toolbar>
                    <paper-icon-button icon="icons:menu" paper-drawer-toggle></paper-icon-button>
                    <div class="title">ANDрејевићи</div>
                    <paper-icon-button icon="icons:done" on-tap="_showList"></paper-icon-button>
                </paper-toolbar>

                <div class="content">
                    <h2>[[tags_response.field_name]]</h2>
                    <template is="dom-repeat" items="[[tags_response.items]]">
                        <paper-button class$="[[_check(item.name, value)]]"
                            data-field$="[[tags_response.field_name]]" on-tap="_showFilteredList">
                            [[item.name]] [[item.count]]
                        </paper-button>
                    </template>

                    <h2>[[date_response.field_name]]</h2>
                    <template is="dom-repeat" items="[[date_response.items]]">
                        <paper-button class$="[[_check(item.name, value)]]"
                            data-field$="[[date_response.field_name]]" on-tap="_showFilteredList">
                            [[item.name]] [[item.count]]
                        </paper-button>
                    </template>
                </div>
            </paper-header-panel>
        </paper-drawer-panel>
    </template>

    <script>
        Polymer({
            is: 'filter-page',
            behaviors: [Polymer.NeonAnimatableBehavior],
            properties: {
                animationConfig: {
                    type: Object,
                    value: function() {
                        return {
                            'entry': {
                                name: 'slide-from-right-animation',
                                node: this
                            },
                            'exit': {
                                name: 'slide-right-animation',
                                node: this
                            }
                        }
                    }
                }
            },
            _tags_url: function(kind) {
                var prefix = 'filter', sufix = '';
                if (kind == 'photo') sufix = 'Photo_tags';
                if (kind == 'entry') sufix = 'Entry_tags';
                var url = [prefix, sufix].join('/');
                return url;
            },
            _date_url: function(kind) {
                var prefix = 'filter', sufix = '';
                if (kind == 'photo') sufix = 'Photo_date';
                if (kind == 'entry') sufix = 'Entry_date';
                var url = [prefix, sufix].join('/');
                return url;
            },
            _check: function(current, selected) {
                if (current == selected) return 'selected';
            },
            _showFilteredList: function(e) {
                var model = e.model,
                    index_page = document.querySelector('index-page');

                index_page.set('data.kind', this.kind);
                index_page.set('dataFilter.field', e.target.dataset.field);
                index_page.set('dataFilter.value', model.item.name);
                this.fire('show-list');
            },
            _showList: function() {
                var index_page = document.querySelector('index-page');

                index_page.set('data.kind', this.kind);
                index_page.set('dataFilter.field', '');
                index_page.set('dataFilter.value', '');
                this.fire('show-list');
            }
        })
    </script>
</dom-module>
