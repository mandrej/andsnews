<link rel="import" href="elements.html">
<link rel="import" href="list-filter.html">
<link rel="import" href="list-grid.html">
<link rel="import" href="list-detail.html">

<dom-module id="index-page">
	<template>
		<style>
			:host {
				display: block;
			}
			main {
				margin-top: 128px;
			}
			@media (max-width: 767px) {
        		main {
          			margin-top: 64px;
				}
        	}
			app-header {
      			position: fixed;
      			top: 0;
      			left: 0;
      			width: 100%;
				color: var(--light-theme-text-color);
                background-color: var(--light-theme-background-color);
				z-index: 1;
          	}
			app-toolbar a {
				display: inline-block;
				margin: 0 16px;
				color: inherit;
				text-decoration: none;
			}
			app-drawer {
				height: 100%;
				/*height: calc(100vh + 128px);*/
			}
			paper-item a {
				color: inherit;
				text-decoration: none;
			}
            paper-item iron-icon {
                margin-right: 16px;
                color: var(--light-theme-secondary-color);
            }
			h1 {
				margin: 0;
				position: absolute;
				top: 0;
				left: 0;
				font-size: 42px;
				font-weight: 100;
				line-height: 64px;
			}
		</style>

		<app-location route="{{route}}" use-hash-as-path></app-location>
		<app-route
			route="{{route}}"
			pattern="/:kind"
			data="{{data}}"
			tail="{{tail}}"
			active="{{active}}"></app-route>

		<app-route
			route="{{tail}}"
			pattern="/:field"
			data="{{dataField}}"
			tail="{{tailField}}"
			active="{{activeField}}"></app-route>

		<app-route
			route="{{tailField}}"
			pattern="/:value"
			data="{{dataValue}}"
			tail="{{tailValue}}"
			active="{{activeValue}}"></app-route>

		<iron-media-query query="max-width: 767px" query-matches="{{smallScreen}}"></iron-media-query>

		<app-header condenses reveals fixed>
			<app-toolbar hidden$="[[smallScreen]]">
				<div title></div>
				<iron-icon icon="icons:search" style="margin-right: 16px"></iron-icon>
				<iron-a11y-keys target="[[targetSearch]]" keys="enter" on-keys-pressed="_onSearch"></iron-a11y-keys>
				<paper-input id="inputSearch" placeholder="search" no-label-float
					value="{{search::input}}"></paper-input>

				<paper-spinner active$="[[loading]]"></paper-spinner>
			</app-toolbar>
	  		<app-toolbar hidden$="[[smallScreen]]" primary>
				<h1 class="logo"><a href="/">ANDрејевићи</a></h1>
				<div title></div>
				<iron-selector attr-for-selected="kind-page" selected="[[data.kind]]" class="layout horizontal">
	                <a href="#/photo" kind-page="photo" on-tap="_resetFilter">Photos</a>
	                <a href="#/entry" kind-page="entry" on-tap="_resetFilter">Texts</a>
				</iron-selector>
			</app-toolbar>
			<app-toolbar hidden$="[[!smallScreen]]">
				<paper-icon-button icon="icons:menu"
					on-tap="_drawerToggle"></paper-icon-button>
				<div title><a href="/">ANDрејевићи</a></div>
				<paper-spinner active$="[[loading]]"></paper-spinner>
			</app-toolbar>

			<app-drawer id="drawer" swipe-open>
				<paper-menu attr-for-selected="kind-page" selected="[[data.kind]]" class="layout vertical">
					<paper-item kind-page="search">
						<iron-icon icon="icons:search" style="margin-right: 16px"></iron-icon>
						<iron-a11y-keys target="[[targetSearch]]" keys="enter" on-keys-pressed="_onSearch"></iron-a11y-keys>
						<paper-input id="inputSearch" placeholder="search" no-label-float
							value="{{search::input}}"></paper-input>
					</paper-item>
					<paper-item kind-page="photo" on-tap="_resetFilter">
		                <a href="#/photo" class="flex">
		                    <iron-icon icon="image:photo-camera"></iron-icon>Photos
		                </a>
		            </paper-item>
		            <paper-item kind-page="entry" on-tap="_resetFilter">
		                <a href="#/entry" class="flex">
		                    <iron-icon icon="icons:description"></iron-icon>Texts
		                </a>
		            </paper-item>
				</paper-menu>
			</app-drawer>
		</app-header>

		<main>
			<app-scrollpos-control selected="{{view}}"></app-scrollpos-control>
			<neon-animated-pages selected="{{view}}" attr-for-selected="data-view">
				<list-filter
					data-view="grid"
					kind="[[data.kind]]"
					field="{{dataField.field}}"
					value="{{dataValue.value}}"
					params="{{params}}"
					route="{{route}}"
					start="{{start}}"
					items="{{items}}"></list-filter>

				<list-detail
					data-view="detail"
					kind="{{data.kind}}"
					field="{{dataField.field}}"
					value="{{dataValue.value}}"
					params="{{params}}"
					route="{{route}}"
					start="{{start}}"
					loading="{{loading}}"
					items="[[items]]"></list-detail>
			</neon-animated-pages>
		</main>
	</template>

	<script>
		Polymer({
			is: 'index-page',
			attached: function() {
				if (!this.route.path) {
					this.set('route.path', '/photo');
					this.set('data.kind', 'photo');
					this.set('dataField.field', null);
					this.set('dataValue.value', null);
				}
			},
			properties: {
				// view: { type: String, value: 'grid', notify: true },
				items: { type: Array, value: [], notify: true },
				start: { type: Number, value: 0, notify: true },
				search: { type: String, value: null, notify: true },
				view: {
					computed: '_viewChanged(data.kind, dataField.field, dataValue.value)',
					value: 'grid',
					notify: true
				},
				targetSearch: {
					type: Object,
					value: function() {
						return this.$.inputSearch
					}
				},
			},
			_viewChanged: function(kind, field, value) {
				if (kind && field) {
					return 'detail';
				}
				return 'grid';
			},
			// listeners: {'menu-toggle': '_menuToggle'},
			_resetFilter: function(e) {
				this.set('params.find', null);
				this.set('params.page', null);
                this.items = [];
				this.set('dataField.field', null);
				this.set('dataValue.value', null);
				this.start = 0;
				var drawer = this.$.drawer;
				drawer.close();
				// this.view = 'grid';

				// var layout = this.$.layout;
                // if (layout.drawer.opened && !layout.drawer.persistent) drawer.close();
			},
			_onSearch: function() {
				// this.set('params.find', null);
				// this.set('params.page', null);
                this.items = [];
				this.set('dataField.field', this.search);
				this.set('dataValue.value', null);
				this.set('route.path', '/search/' + this.search);
				// this.fire('menu-toggle');
				this.start = 0;
				var drawer = this.$.drawer;
				drawer.close();
				// this.view = 'detail';
			},
			// _menuToggle: function(e) {
				// var layout = this.$.layout;
				// if (!layout.drawer.persistent) {
				// 	layout.drawer.opened = !layout.drawer.opened;
				// }
			// },
			_drawerToggle: function() {
				console.log('TAP');
				var drawer = this.$.drawer;
				drawer.toggle();
			}
		});
	</script>
</dom-module>
