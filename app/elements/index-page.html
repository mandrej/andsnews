<link rel="import" href="list-page.html">
<link rel="import" href="filter-page.html">

<dom-module id="index-page">
	<template>
		<carbon-location route="{{route}}" use-hash-as-path></carbon-location>

		<carbon-route
			route="{{route}}"
			pattern="/:kind"
			data="{{dataKind}}"
			tail="{{tailKind}}"
			active="{{activeKind}}"></carbon-route>

        <carbon-route
			route="{{tailKind}}"
			pattern="/:field/:value"
			data="{{dataFilter}}"
			tail="{{tailFilter}}"
			active="{{activeFilter}}"></carbon-route>

		<iron-selector selected="{{data.kind}}" attr-for-selected="kind-page"></iron-selector>

		<h1>{{activeKind}} {{activeFilter}}</h1>

		<iron-pages selected="{{selected}}">
			<list-page
				kind="{{dataKind.kind}}"
				field=""
				value=""
				route="{{tailKind}}"
				active="{{activeKind}}"></list-page>

			<list-page
				kind="{{dataKind.kind}}"
				field="{{dataFilter.field}}"
				value="{{dataFilter.value}}"
				route="{{tailFilter}}"
				active="{{activeFilter}}"></list-page>
		</iron-pages>
	</template>

	<script>
		Polymer({
			is: 'index-page',
			attached: function() {
				if (!this.route.path) {
					this.set('dataKind.kind', 'photo');
					this.set('route.path', '/photo');
				}
			},
			properties: {
				selected: {
					type: Number,
					computed: '_selected(activeKind, activeFilter)',
					// observer: 'propertyChanged'
				},
				route: {
					type: Object,
					observer: 'objectChanged'
				}
			},
			_selected: function(activeKind, activeFilter) {
				console.log(activeKind, activeFilter);
				if (activeKind && activeFilter) {
					return 1;
				} else {
					return 0;
				}
			},
			// listeners: {
			// 	'show-index': 'showIndex',
			// 	'show-filters': 'showFilters'
			// },
			// showIndex: function() {
			// 	this.selected = 0;
			// },
			// showFilters: function() {
			// 	this.selected = 1;
			// },
			propertyChanged: function(newValue, oldValue) {
				console.log([oldValue || 'undefined', ' -> ', newValue].join(''));
			},
			objectChanged: function(newValue, oldValue) {
				console.log(newValue);
			}
		});
	</script>
</dom-module>
