<link rel="import" href="elements.html">
<link rel="import" href="list-filter.html">
<link rel="import" href="list-grid.html">
<link rel="import" href="list-detail.html">

<dom-module id="index-page">
	<template>
		<style is="custom-style" include="shared-styles"></style>
		<style>
			:host {
				display: block;
				@apply(--paper-font-common-base);
			}
			paper-input {
				--paper-input-container-input-color: var(--dark-theme-text-color);
			}
		</style>

		<app-location route="{{route}}" use-hash-as-path></app-location>
		<app-route
			route="{{route}}"
			pattern="/:kind"
			data="{{data}}"
			tail="{{tail}}"
			active="{{active}}"></app-route>

		<app-route
			route="{{tail}}"
			pattern="/:field"
			data="{{dataField}}"
			tail="{{tailField}}"
			active="{{activeField}}"></app-route>

		<app-route
			route="{{tailField}}"
			pattern="/:value"
			data="{{dataValue}}"
			tail="{{tailValue}}"
			active="{{activeValue}}"></app-route>

		<app-drawer-layout id="layout">
			<app-drawer id="drawer">
				<app-header fixed>
					<app-toolbar>
						<iron-icon icon="icons:search" style="margin-right: 16px"></iron-icon>
						<iron-a11y-keys target="[[targetSearch]]" keys="enter" on-keys-pressed="_onSearch"></iron-a11y-keys>
						<paper-input id="inputSearch" placeholder="search" no-label-float
						value="{{search::input}}"></paper-input>
					</app-toolbar>
					<app-toolbar>
						<paper-menu attr-for-selected="kind-page" selected="[[data.kind]]" class="fit">
							<paper-item kind-page="photo" on-tap="_resetFilter">
				                <a href="#/photo" class="flex">
				                    <iron-icon icon="image:photo-camera"></iron-icon>Photos
				                </a>
				            </paper-item>
				            <paper-item kind-page="entry" on-tap="_resetFilter">
				                <a href="#/entry" class="flex">
				                    <iron-icon icon="icons:description"></iron-icon>Texts
				                </a>
				            </paper-item>

							<list-filter
			                    kind="[[data.kind]]"
			                    field="{{dataField.field}}"
			                    value="{{dataValue.value}}"
			                    route="{{route}}"
			                    items="{{items}}"></list-filter>
						</paper-menu>
					</app-toolbar>
				</app-header>
			</app-drawer>

			<app-header-layout>
				<content select=".content">
					<app-scrollpos-control selected="{{view}}"></app-scrollpos-control>
					<neon-animated-pages selected="{{view}}" attr-for-selected="data-view">
						<list-grid
							data-view="grid"
							kind="{{data.kind}}"
							field="{{dataField.field}}"
							value="{{dataValue.value}}"
							route="{{route}}"
							selected="{{selected}}"
							loading="{{loading}}"
							items="{{items}}"></list-grid>

						<list-detail
							data-view="detail"
							route="{{route}}"
							selected="[[selected]]"
							items="[[items]]"></list-detail>
					</neon-animated-pages>
				</content>
            </app-header-layout>
		</app-drawer-layout>
	</template>

	<script>
		Polymer({
			is: 'index-page',
			attached: function() {
				if (!this.route.path) {
					this.set('route.path', '/photo');
					this.set('data.kind', 'photo');
					this.set('dataField.field', null);
					this.set('dataValue.value', null);
				}
			},
			properties: {
				view: { type: String, value: 'grid', notify: true, observer: '_toggleDrawer' },
				items: { type: Array, value: [], notify: true },
				search: { type: String, value: null, notify: true },
				targetSearch: {
					type: Object,
					value: function() {
						return this.$.inputSearch
					}
				},
			},
			listeners: {'menu-toggle': '_menuToggle'},
			_resetFilter: function(e) {
				document.querySelector('#list_ajax').params = {};
                this.items = [];
				this.set('dataField.field', null);
				this.set('dataValue.value', null);

				var layout = this.$.layout;
                if (layout.drawer.opened && !layout.drawer.persistent) drawer.close();
			},
			_onSearch: function() {
				document.querySelector('#list_ajax').params = {};
                this.items = [];
				this.set('dataField.field', this.search);
				this.set('dataValue.value', null);
				this.set('route.path', '/search/' + this.search);
				this.fire('menu-toggle');
			},
			_menuToggle: function(e) {
				var layout = this.$.layout;
				if (!layout.drawer.persistent) {
					layout.drawer.opened = !layout.drawer.opened;
				}
			},
			_toggleDrawer: function(newValue, oldValue) {
				var layout = this.$.layout;
				layout.forceNarrow = layout.drawer.persistent && newValue == 'detail';
			}
		});
	</script>
</dom-module>
