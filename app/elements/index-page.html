<link rel="import" href="elements.html">
<link rel="import" href="list-search.html">
<link rel="import" href="list-filter.html">
<link rel="import" href="list-detail.html">

<dom-module id="index-page">
	<template>
		<style>
			:host {
				display: block;
			}
			main {
				margin-top: 128px;
			}
			@media (max-width: 767px) {
        		main {
          			margin-top: 64px;
				}
        	}
			app-header {
      			position: fixed;
      			top: 0;
      			left: 0;
      			width: 100%;
				color: var(--light-theme-text-color);
                background-color: var(--light-theme-background-color);
				z-index: 1;
          	}
			app-toolbar a {
				color: inherit;
				text-decoration: none;
			}
			app-drawer {
				min-height: 100vh;
			}
			paper-item a {
				color: inherit;
				text-decoration: none;
			}
            paper-item iron-icon {
                margin-right: 16px;
                color: var(--light-theme-secondary-color);
            }
			paper-button {
				text-transform: lowercase;
			}
			h1 {
				margin: 0 0 0 16px;
				position: absolute;
				top: 0;
				left: 0;
				font-size: 36px;
				font-weight: 300;
				line-height: 64px;
			}
			@media (max-width: 767px) {
        		h1 {
          			margin-left: 64px;
				}
        	}
			h1 a {
				background: -webkit-linear-gradient(#fff, #000);
				-webkit-background-clip: text;
				-webkit-text-fill-color: transparent;
			}
		</style>

		<app-location route="{{route}}" use-hash-as-path></app-location>
		<app-route
			route="{{route}}"
			pattern="/:kind"
			data="{{data}}"
			tail="{{tail}}"
			active="{{active}}"></app-route>

		<app-route
			route="{{tail}}"
			pattern="/:field"
			data="{{dataField}}"
			tail="{{tailField}}"
			active="{{activeField}}"></app-route>

		<app-route
			route="{{tailField}}"
			pattern="/:value"
			data="{{dataValue}}"
			tail="{{tailValue}}"
			active="{{activeValue}}"></app-route>

		<iron-media-query query="max-width: 767px" query-matches="{{smallScreen}}"></iron-media-query>

		<app-header condenses fixed>
			<app-toolbar hidden$="[[smallScreen]]">
    			<div main-title>[[data.kind]], [[dataField.field]], [[dataValue.value]], [[view]], [[start]]</div>
				<list-search
					field="{{dataField.field}}"
					value="{{dataValue.value}}"
					params="{{params}}"
					route="{{route}}"
					start="{{start}}"
					items="{{items}}"></list-search>
				<paper-spinner active$="[[loading]]"></paper-spinner>
  			</app-toolbar>
			<app-toolbar sticky>
				<paper-icon-button icon="icons:menu" hidden$="[[!smallScreen]]"
					on-tap="_drawerToggle"></paper-icon-button>
				<h1 class="logo"><a href="/">ANDрејевићи</a></h1>
				<div main-title></div>
				<iron-selector attr-for-selected="kind-page" selected="[[data.kind]]" hidden$="[[smallScreen]]">
	                <a href="#/photo" kind-page="photo" on-tap="_resetFilter">
						<paper-button>Photos</paper-button></a>
	                <a href="#/entry" kind-page="entry" on-tap="_resetFilter">
						<paper-button>Texts</paper-button></a>
				</iron-selector>
			</app-toolbar>

			<app-drawer id="drawer" swipe-open>
				<paper-menu attr-for-selected="kind-page" selected="[[data.kind]]" class="layout vertical">
					<paper-item>
						<list-search
							field="{{dataField.field}}"
							value="{{dataValue.value}}"
							params="{{params}}"
							route="{{route}}"
							start="{{start}}"
							items="{{items}}"></list-search>
					</paper-item>
					<paper-item kind-page="photo" on-tap="_resetFilter">
		                <a href="#/photo" class="flex">
		                    <iron-icon icon="image:photo-camera"></iron-icon>Photos
		                </a>
		            </paper-item>
		            <paper-item kind-page="entry" on-tap="_resetFilter">
		                <a href="#/entry" class="flex">
		                    <iron-icon icon="icons:description"></iron-icon>Texts
		                </a>
		            </paper-item>
				</paper-menu>
			</app-drawer>
		</app-header>

		<main>
			<app-scrollpos-control selected="{{view}}"></app-scrollpos-control>
			<neon-animated-pages selected="{{view}}" attr-for-selected="data-view">
				<list-filter
					data-view="grid"
					kind="[[data.kind]]"
					field="{{dataField.field}}"
					value="{{dataValue.value}}"
					params="{{params}}"
					route="{{route}}"
					start="{{start}}"
					items="{{items}}"></list-filter>

				<list-detail
					data-view="detail"
					kind="{{data.kind}}"
					field="{{dataField.field}}"
					value="{{dataValue.value}}"
					params="{{params}}"
					route="{{route}}"
					start="{{start}}"
					loading="{{loading}}"
					items="[[items]]"></list-detail>
			</neon-animated-pages>
		</main>
	</template>

	<script>
		Polymer({
			is: 'index-page',
			attached: function() {
				if (!this.route.path) {
					this.set('route.path', '/photo');
					this.set('data.kind', 'photo');
					this.set('dataField.field', null);
					this.set('dataValue.value', null);
				}
			},
			properties: {
				items: { type: Array, value: [], notify: true },
				start: { type: Number, value: 0, notify: true },
				view: {
					computed: '_viewChanged(data.kind, dataField.field)',
					value: 'grid',
					notify: true
				},
			},
			_viewChanged: function(kind, field) {
				if (kind && field) {
					return 'detail';
				}
				return 'grid';
			},
			_resetFilter: function(e) {
				this.set('params.find', null);
				this.set('params.page', null);
				this.set('dataField.field', null);
				this.set('dataValue.value', null);
				this.items = [];
				this.start = 0;
				this.$.drawer.close();
			},
			_drawerToggle: function() {
				this.$.drawer.toggle();
			}
		});
	</script>
</dom-module>
