<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/paper-button/paper-button.html">
<link rel="import" href="../bower_components/iron-icon/iron-icon.html">
<link rel="import" href="../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../bower_components/iron-icons/image-icons.html">
<link rel="import" href="../bower_components/paper-chip/paper-chip.html">

<link rel="import" href="./shared-styles.html">

<dom-module id="item-info">
  <template>
    <style include="shared-styles iron-flex iron-flex-alignment">
       :host {
        display: block;
        position: relative;
        background-color: var(--primary-background-color);
        padding: 16px;
      }
      h2 {
        margin: 0;
        font-size: 24px;
        font-weight: 300;
      }
      paper-button {
        margin-top: 8px;
      }
      paper-chip {
        cursor: pointer;
        margin-right: 8px;
      }
      .white {
        margin: 0;
        padding: 0;
        color: var(--primary-text-color);
        background-color: var(--primary-background-color);
        text-transform: none;
      }
      paper-chip.accent {
        --paper-chip-background-color: var(--accent-color);
      }
    </style>

    <h2>[[item.headline]]</h2>
    <paper-button on-tap="_downloadPhoto" class="white">
      Download ([[item.size]])
      <iron-icon icon="file-download"></iron-icon>
    </paper-button>
    <p>
      [[_dateFormat(item.date)]]
      <br>[[item.author]]
      <br>
      <br>[[item.model]]
      <br>[[item.lens]] ([[item.focal_length]]mm)
      <br>f[[item.aperture]] [[item.shutter]]s [[item.iso]] ASA
    </p>
    <div class="layout horizontal wrap">
      <paper-chip label="[[item.year]]" no-image class$="[[activeFilter('date', item.year, filter)]]" on-tap="applyFilter" data-field="date"
        data-field-value$="[[item.year]]"></paper-chip>
      <template is="dom-repeat" items="[[item.tags]]" as="tag">
        <paper-chip label="[[tag]]" no-image class$="[[activeFilter('tags', tag, filter)]]" on-tap="applyFilter" data-field="tags"
          data-field-value$="[[tag]]"></paper-chip>
      </template>
      <paper-chip label="[[item.model]]" no-image class$="[[activeFilter('model', item.model, filter)]]" on-tap="applyFilter" data-field="model"
        data-field-value$="[[item.model]]"></paper-chip>
      <paper-chip label="[[item.color]]" no-image class$="[[activeFilter('color', item.color, filter)]]" on-tap="applyFilter" data-field="color"
        data-field-value$="[[item.color]]"></paper-chip>
    </div>
  </template>

  <script>
    Polymer({
      is: 'item-info',
      _downloadPhoto: function () {
        window.location.href = '/api/download/' + this.item.safekey;
      },
      _dateFormat: function (str) {
        return moment(str, 'YYYY-MM-DDTHH:mm:ss').format('LLL');
        // return moment(str, 'YYYY-MM-DDTHH:mm:ss').locale('sr').format('LLL');
        // return moment(str, 'YYYY-MM-DDTHH:mm:ss').locale('sr').fromNow();
      },
      activeFilter: function (field, value, filter) {
        return (filter[field] == value) ? 'accent' : '';
      },
      applyFilter: function (e) {
        const target = e.target,
          field = target.dataset.field,
          value = target.dataset.fieldValue;
        this.set('route.path', ['/detail', this.item.kind, field, value].join('/'));
      },
    });
  </script>
  <script src="../bower_components/moment/min/moment.min.js"></script>
</dom-module>
