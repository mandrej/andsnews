<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/paper-button/paper-button.html">
<link rel="import" href="../bower_components/iron-icon/iron-icon.html">
<link rel="import" href="../bower_components/paper-chip/paper-chip.html">

<link rel="import" href="redux-store.html">
<link rel="import" href="shared-styles.html">

<dom-module id="item-info">
  <template>
    <style include="shared-styles">
      .container {
        padding: 16px;
      }
      h2 {
        margin: 0;
        font-size: 24px;
        font-weight: 300;
      }
      paper-button {
        margin-top: 8px;
      }
      paper-chip {
        cursor: pointer;
        margin-right: 8px;
        --paper-chip-background-color: var(--light-primary-color);
      }
      paper-chip.accent {
        --paper-chip-background-color: var(--accent-color);
      }
      a[download] {
        text-decoration: none;
      }
    </style>

    <div class="container">
      <h2>[[item.headline]]</h2>
      <a href="/api/download/[[item.safekey]]" download target="_blank">
        <paper-button>
          Download ([[item.size]])
          <iron-icon icon="app:file-download"></iron-icon>
        </paper-button>
      </a>
      <p>
        [[_dateFormat(item.date)]]
        <br>[[item.author]]
        <br>
        <br>[[item.model]]
        <br>[[item.lens]] ([[item.focal_length]]mm)
        <br>f[[item.aperture]] [[item.shutter]]s [[item.iso]] ASA
      </p>
      <div class="layout horizontal wrap">
        <paper-chip label="[[item.year]]" no-image class$="[[activeFilter('date', item.year, filter)]]" on-tap="applyFilter" data-field="date"
          data-field-value$="[[item.year]]"></paper-chip>
        <template is="dom-repeat" items="[[item.tags]]" as="tag">
          <paper-chip label="[[tag]]" no-image class$="[[activeFilter('tags', tag, filter)]]" on-tap="applyFilter" data-field="tags"
            data-field-value$="[[tag]]"></paper-chip>
        </template>
        <paper-chip label="[[item.model]]" no-image class$="[[activeFilter('model', item.model, filter)]]" on-tap="applyFilter" data-field="model"
          data-field-value$="[[item.model]]"></paper-chip>
        <paper-chip label="[[item.color]]" no-image class$="[[activeFilter('color', item.color, filter)]]" on-tap="applyFilter" data-field="color"
          data-field-value$="[[item.color]]"></paper-chip>
      </div>
    </div>
  </template>

  <script>
    Polymer({
      is: 'item-info',
      behaviors: [ ReduxBehavior ],
      actions: {
        change: function (payload) {
          return {
            type: 'CURRENT_CHANGED',
            payload: payload
          }
        }
      },
      // _downloadPhoto: function () {
      //   window.location = '/api/download/' + this.item.safekey;
      // },
      _dateFormat: function (str) {
        return moment(str, 'YYYY-MM-DDTHH:mm:ss').format('LLL');
      },
      activeFilter: function (field, value, filter) {
        return (filter[field] == value) ? 'accent' : '';
      },
      applyFilter: function (e) {
        const target = e.target,
          field = target.dataset.field,
          value = target.dataset.fieldValue;
        this.dispatch('change', {
            view: 'display',
            disableSwipe: false
          });
        this.set('route.path', ['/detail', this.item.kind, field, value].join('/'));
      },
    });
  </script>
  <script src="../bower_components/moment/min/moment.min.js"></script>
</dom-module>
