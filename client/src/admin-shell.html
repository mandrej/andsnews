<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/iron-flex-layout/iron-flex-layout-classes.html">
<link rel="import" href="../bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="../bower_components/google-signin/google-signin.html">
<link rel="import" href="../bower_components/paper-button/paper-button.html">
<link rel="import" href="../bower_components/neon-animation/neon-animation.html">
<link rel="import" href="../bower_components/neon-animation/neon-animation-behavior.html">

<dom-module id="admin-shell">
    <template>
        <style is="custom-style" include="iron-flex iron-flex-alignment"></style>
        <style>
            :host {
                @apply(--layout-horizontal);
                @apply(--layout-start-aligned);
                @apply(--layout-wrap);
            }
            h2 {
				margin-top: 0;
				font-size: 24px;
				font-weight: 300;
			}
            a {
                text-decoration: none;
            }
            .card {
                padding: 16px;
                position: relative;
                box-sizing: border-box;
                width: 50%;
            }
            @media (max-width: 768px)  { .card { width: 100%; } }
            paper-button {
                color: var(--dark-theme-base-color);
                background-color: var(--primary-color);
                text-transform: lowercase;
			}
            #google {
                background-color: var(--paper-red-500)
			}
            #google[active] {
                background-color: var(--primary-color);
            }
            paper-checkbox {
                /*--paper-checkbox-checked-color: var(--paper-green-500);
                --paper-checkbox-checked-ink-color: var(--paper-green-500);
                --paper-checkbox-unchecked-color: var(--paper-green-900);
                --paper-checkbox-unchecked-ink-color: var(--paper-green-900);
                --paper-checkbox-label-color: var(--paper-green-500);*/
                --paper-checkbox-label-spacing: 0;
                --paper-checkbox-margin: 0 16px 8px 0;
                --paper-checkbox-vertical-align: top;
            }
        </style>

        <google-signin-aware id="aware"
            client-id="719127177629-l03racul4r8fsvs31l4fonlk51k04t92.apps.googleusercontent.com"
            is-authorized="{{isAuthorized}}"
            on-google-signin-aware-success="handleSignIn"></google-signin-aware>

        <iron-request id="rebuild_ajax"></iron-request>

        <div class="card">
            <div class="flex">
                <paper-button toggles active="[[isAuthorized]]" id="google" on-tap="signGoogle">Google Sign In</paper-button></a>
            </div>
        </div>

        <div class="card">
            <h2>Memcache</h2>
            <div class="flex">
                <template is="dom-repeat" items="[[memkeys]]" as="item">
                    <paper-button on-tap="rebuild" style="margin-bottom: 8px">[[item]]</paper-button>
                </template>
            </div>
        </div>
    </template>
    <script>
        Polymer({
            is: 'admin-shell',
            behaviors: [
                Polymer.NeonAnimationBehavior
            ],
            properties: {
                animationConfig: {
                    type: Object,
                    value: function() {
                        return {
                            'entry': [{
                                name: 'slide-from-right-animation',
                                node: this
                            }],
                            'exit': [{
                                name: 'slide-right-animation',
                                node: this
                            }]
                        }
                    }
                },
                isAuthorized: { type: Boolean, value: false, notify: true },
                user: { type: Object, notify: true },
                memkeys: {type: Array },
            },
            ready: function() {
                this.memkeys = ['Photo_date', 'Photo_tags', 'Photo_model'];
            },
            signGoogle: function() {
                if (this.isAuthorized) {
                    this.user.disconnect();
					this.isAuthorized = false;
        			this.user = null;
                    gapi.auth2.getAuthInstance().signOut();
                    this.$.google.innerText = 'Google Sign-In';
                } else {
                    this.$.aware.signIn();
                }
            },
            handleSignIn: function(response) {
                this.user = gapi.auth2.getAuthInstance()['currentUser'].get();
                this.$.google.innerText = this.user.getBasicProfile().getName() + ' Sign-Out';
				console.log(this.user.getBasicProfile().getId());
				// .getBasicProfile().getName();
				// .getBasicProfile().getEmail();
				// .getBasicProfile().getImageUrl();
            },
            rebuild: function(e) {
                this.$.rebuild_ajax.send({url: '/api/memcache/' + e.model.item, method: 'PUT'});
            }
        });
    </script>
</dom-module>
