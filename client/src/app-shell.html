<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/app-route/app-location.html">
<link rel="import" href="../bower_components/app-route/app-route.html">
<link rel="import" href="../bower_components/iron-media-query/iron-media-query.html">
<link rel="import" href="../bower_components/app-layout/app-header/app-header.html">
<link rel="import" href="../bower_components/app-layout/app-scroll-effects/app-scroll-effects.html">
<link rel="import" href="../bower_components/app-layout/app-drawer/app-drawer.html">
<link rel="import" href="../bower_components/app-layout/app-toolbar/app-toolbar.html">
<link rel="import" href="../bower_components/iron-selector/iron-selector.html">
<link rel="import" href="../bower_components/iron-flex-layout/iron-flex-layout-classes.html">
<link rel="import" href="../bower_components/paper-menu/paper-menu.html">
<link rel="import" href="../bower_components/paper-item/paper-item.html">
<link rel="import" href="../bower_components/paper-spinner/paper-spinner.html">
<link rel="import" href="../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../bower_components/paper-button/paper-button.html">
<link rel="import" href="../bower_components/iron-icon/iron-icon.html">
<link rel="import" href="../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../bower_components/iron-icons/image-icons.html">
<link rel="import" href="../bower_components/app-layout/app-scrollpos-control/app-scrollpos-control.html">
<link rel="import" href="../bower_components/neon-animation/neon-animated-pages.html">

<link rel="import" href="app-search.html">
<link rel="import" href="grid-view.html">
<link rel="import" href="detail-view.html">

<dom-module id="app-shell">
	<template>
		<style is="custom-style" include="iron-flex iron-flex-alignment"></style>
		<style>
			:host {
				display: block;
			}
			main {
				margin-top: 128px;
			}
			@media (max-width: 767px) {
        		main {
          			margin-top: 64px;
				}
        	}
			app-header {
      			position: fixed;
      			top: 0;
      			left: 0;
      			width: 100%;
				color: var(--light-theme-text-color);
				z-index: 1;
				background-color: var(--light-theme-background-color);
				@apply(--shadow-elevation-2dp);
      			/*--app-header-background-front-layer: {
					background-color: var(--google-yellow-300);
      			};
				--app-header-background-rear-layer: {
        			background-color: var(--light-theme-background-color);
      			};*/
          	}
			app-toolbar a, paper-item a {
				color: inherit;
				text-decoration: none;
			}
			app-drawer {
				min-height: 100vh;
				top: 0;
				bottom: 0;
				--app-drawer-content-container: {
					padding: 0;
				}
			}
			app-drawer app-toolbar {
				background-color: var(--google-yellow-300);
				@apply(--shadow-elevation-2dp);
			}
            paper-item iron-icon {
                margin-right: 16px;
                color: var(--light-theme-secondary-color);
            }
			paper-button {
				text-transform: lowercase;
			}
			h1 {
				margin: 0;
				font-size: 36px;
				font-weight: 300;
				white-space: nowrap;
				overflow: hidden;
				text-overflow: ellipsis;
			}
			@media (max-width: 767px) {
        		h1 {
					margin: 0 12px;
					font-size: 24px;
				}
        	}
		</style>

		<!--
		/:view	/:kind	/:field	/:value
		view:	grid, detail, admin
		kind:	photo, entry, search
		-->

		<app-location route="{{route}}" use-hash-as-path></app-location>

		<app-route
			route="{{route}}"
			pattern="/:view"
			data="{{dataView}}"
			tail="{{tailView}}"
			active="{{activeView}}"></app-route>

		<app-route
			route="{{tailView}}"
			pattern="/:kind"
			data="{{dataKind}}"
			tail="{{tailKind}}"
			active="{{activeKind}}"></app-route>

		<app-route
			route="{{tailKind}}"
			pattern="/:field"
			data="{{dataField}}"
			tail="{{tailField}}"></app-route>

		<app-route
			route="{{tailField}}"
			pattern="/:value"
			data="{{dataValue}}"></app-route>

		<iron-media-query query="max-width: 767px" query-matches="{{smallScreen}}"></iron-media-query>

		<app-header condenses waterfall fixed effects="waterfall blend-background parallax-background">
			<template is="dom-if" if="[[!smallScreen]]">
				<app-toolbar>
					<!-- [[dataKind.kind]], [[dataField.field]], [[dataValue.value]], [[view]], [[start]] -->
					<div main-title>[[version]]</div>
					<paper-spinner active$="[[loading]]"></paper-spinner>
				</app-toolbar>
			</template>
			<app-toolbar sticky>
				<template is="dom-if" if="[[_isDetail(dataView.view)]]">
					<paper-icon-button icon="chevron-left" on-tap="_resetFilter"></paper-icon-button>
				</template>
				<template is="dom-if" if="[[!_isDetail(dataView.view)]]">
					<template is="dom-if" if="[[smallScreen]]">
						<paper-icon-button icon="menu" on-tap="_drawerToggle"></paper-icon-button>
					</template>
				</template>

				<h1 main-title>{{headline}}</h1>

				<template is="dom-if" if="[[_isDetail(dataView.view)]]">
					<template is="dom-if" if="[[_isPhoto(dataKind.kind)]]">
						<paper-icon-button icon="more-vert" on-tap="showExif"></paper-icon-button>
					</template>
				</template>
				<template is="dom-if" if="[[!_isDetail(dataView.view)]]">
					<template is="dom-if" if="[[!smallScreen]]">
						<iron-selector attr-for-selected="kind-page" selected="[[dataKind.kind]]">
							<a href="#/grid/photo" kind-page="photo" on-tap="_resetFilter">
								<paper-button>Photos</paper-button></a>
							<a href="#/grid/entry" kind-page="entry" on-tap="_resetFilter">
								<paper-button>Texts</paper-button></a>
						</iron-selector>
						<app-search
							field="{{dataField.field}}"
							value="{{dataValue.value}}"
							route="{{route}}"></app-search>
					</template>
					<template is="dom-if" if="[[smallScreen]]">
						<app-search
							field="{{dataField.field}}"
							value="{{dataValue.value}}"
							route="{{route}}"></app-search>
					</template>
				</template>
			</app-toolbar>

			<app-drawer id="drawer" swipe-open>
				<app-toolbar>
					<h1 main-title>ANDрејевићи</h1>
				</app-toolbar>
				<paper-menu attr-for-selected="kind-page" selected="[[dataKind.kind]]" class="layout vertical">
					<paper-item kind-page="photo" on-tap="_resetFilter">
		                <a href="#/grid/photo" class="flex">
		                    <iron-icon icon="image:photo-camera"></iron-icon>Photos
		                </a>
		            </paper-item>
		            <paper-item kind-page="entry" on-tap="_resetFilter">
		                <a href="#/grid/entry" class="flex">
		                    <iron-icon icon="description"></iron-icon>Texts
		                </a>
		            </paper-item>
				</paper-menu>
				<paper-item>[[version]]</paper-item>
			</app-drawer>
		</app-header>

		<main>
			<app-scrollpos-control selected="{{dataView.view}}"></app-scrollpos-control>
			<neon-animated-pages selected="{{dataView.view}}" attr-for-selected="data-view" id="neon">
				<grid-view
					data-view="grid"
					kind="[[dataKind.kind]]"
					field="{{dataField.field}}"
					value="{{dataValue.value}}"
					route="{{route}}"></grid-view>

				<detail-view
					data-view="detail"
					kind="{{dataKind.kind}}"
					field="{{dataField.field}}"
					value="{{dataValue.value}}"
					route="{{route}}"
					loading="{{loading}}"
					headline="{{headline}}"></detail-view>
			</neon-animated-pages>
		</main>
	</template>

	<script>
		Polymer({
			is: 'app-shell',
			attached: function() {
				if (!this.route.path) {
					this.set('route.path', '/grid/photo');
					this.set('dataView.view', 'grid');
					this.set('dataKind.kind', 'photo');
					this.set('dataField.field', null);
					this.set('dataValue.value', null);
				}
			},
			properties: {
				version: { type: String, value: '1607 27T11'},
				headline: { type: String, value: 'ANDрејевићи', notify: true },
				smallScreen: { type: Boolean, value: false, notify: true },
				loading: { type: Boolean, value: false, notify: true },
			},
			_isDetail: function(view) {
				return view == 'detail';
			},
			_resetFilter: function(e) {
				if (this.dataKind.kind == 'search') {
					this.set('dataKind.kind', 'photo');
				}
				this.set('route.path', ['', 'grid', this.dataKind.kind].join('/'));
				this.set('dataField.field', null);
				this.set('dataValue.value', null);

				this.headline = 'ANDрејевићи'
				this.$.drawer.close();
			},
			_drawerToggle: function() {
				this.$.drawer.toggle();
			},
			_isPhoto: function(kind) {
				return kind == 'photo'
			},
			showExif: function(e) {
				this.$$('detail-view').fire('show-exif');
            },
		});
	</script>
</dom-module>
