<!DOCTYPE html>
<html lang="{{ LANGUAGE_CODE }}">
<head>
	<meta charset="utf-8"/>
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
	<meta name="apple-mobile-web-app-capable" content="yes"/>
	<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"/>
	<meta name="verify-v1" content="500ha7MSGCMgwkQG3S+CaeF1KzDLZB3Q9Ly5o+R7g5w="/>
	<meta name="keywords" content="gae, google appengine, google app engine, django, python, html5, andrejevic"/>
	{% block meta %}<meta name="date" content="2008-03-01"/>{% endblock %}
	<title>{% block title %}ANDрејевићи{% endblock %}</title>
	<link type="text/css" rel="stylesheet" href="/static/css/base.css"/>
	<link type="application/rss+xml" rel="alternate" href="/rss/photo.xml" title="{{ _('photo rss') }}" />
	<link type="application/rss+xml" rel="alternate" href="/rss/entry.xml" title="{{ _('entry rss') }}" />
	<link type="image/x-icon" rel="shortcut icon" href="/static/images/favicon.ico"/>
</head>
{% import "snippets/macros.html" as m %}
<body>
	{% block modals %}
	<div id="overlay" class="hide"></div>
	<div id="confirm" class="modal"></div>
	<div id="spinner" class="modal">{{ m.spinner() }}</div>
	{% endblock %}

    <nav class="menu">
        {% block tools %}
            <div id="forms">
                <form id="langs" action="/setlang" method="post">
                    {% for code, lang in LANGUAGES %}
                        <button class="{% if code == LANGUAGE_CODE %}current{% endif %}"
                            type="submit" name="language" value="{{ code }}" title="{{ lang }}">{{ language(code) }}</button>
                    {% endfor %}
                </form>
                <form id="searchForm" action="/search" method="get">
                    <button type="submit">{{ _('search') }}</button>
                    <input type="text" name="find"/>
                </form>
            </div>
        {% endblock %}
        {% block nav %}{{ m.menu('') }}{% endblock %}

        {% if is_admin %}
            <a href="/admin/" title="{{ _('Administration') }}" class="Admin">{{ _('Administration') }}</a>
        {% endif %}
        {% if user %}
            <a href="/sign" class="Logout">{{ _('Logout') }}</a>
        {% else %}
            <a href="/sign" class="Login">{{ _('Sign in') }}</a>
        {% endif %}

        <p id="footer">© АNDS v.{{ version() }} 2008-{{ year() }}
            powered by <a href="http://code.google.com/appengine/">Google App Engine {{ gaesdk() }}</a>
            {% if user %}<br><strong>{{ user.nickname() }}</strong>{% endif %}
        </p>
    </nav>
    <header id="header">
        <h1><a href="{{ uri_for('start') }}" title="{{ _('Start') }}">ANDрејевићи</a></h1>
        <a class="icon-home icon-4x" href="{{ uri_for('start') }}" title="{{ _('Start') }}"></a>
        <a href="#" id="tools" class="icon-reorder icon-4x" title="{{ _('Tools') }}"></a>
        <nav class="paginator">{% block paging %}{% include 'snippets/paginator.html' %}{% endblock %}</nav>
    </header>
    <div id="main">{% block contents %}{% endblock %}</div>

    {% block scripts %}
        <script src="https://www.google.com/jsapi"></script>
        <script>google.load('jquery', '1.7');</script>
        <script src="/static/scripts/imagesloaded.min.js"></script>
        <script src="/static/scripts/jquery.infinitescroll.min.js"></script>
        <script src="/static/scripts/jquery.masonry.min.js"></script>
        <script src="/static/scripts/common.js"></script>
        <script>
            $(function() {
                var $pinner = $('#overlay, #spinner');
                var kind = '{{ kind }}';
                var crumbs = location.pathname.split('/');
                crumbs.shift();
                crumbs.shift();

                $('a.confirm').click(function() {
                    $('#confirm').load(this.href, function() {
                        $('#overlay, #confirm').show();
                    });
                    return false
                });
                $('#searchForm').submit(function() {
                    $pinner.show();
                });

                if (kind != '') {
                    $('.hide').hide();
                    $('.collapse').each(function() {
                        $(this).plus();
                    });

                    if (crumbs.length >= 2) {
                        var field = crumbs[0];
                        var available = ['tags', 'date', 'author', 'color', 'model', 'lens', 'eqv', 'iso', 'forkind'];
                        if ($.inArray(field, available) != -1) {
                            $.ajax({
                                url: '/filter/' + kind + '_' + field + '/' + crumbs[1],
                                context: $('#' + field + 'cloud'),
                                success: function(snippet) {
                                    $(this).html(snippet).slideDown();
                                    $('.' + field).minus();
                                }
                            });
                        }
                    }
                }

                $('.collapse').click(function() {
                    var cntx = $(this);
                    var url = cntx.attr('href');
                    var key = url.split('/').pop();
                    var field = key.split('_').pop();

                    $('.hide').slideUp();
                    $('.collapse').each(function() {
                        $(this).plus();
                    });

                    $pinner.show();
                    if (crumbs[0] == field && crumbs[1] != undefined) url += '/' + crumbs[1];
                    $.ajax({
                        url: url,
                        context: $('#' + field + 'cloud'),
                        success: function(snippet) {
                            $(this).html(snippet).slideDown();
                            cntx.minus();
                            $pinner.hide();
                        }
                    });
                    return false
                });

                $('#tools').click(function() {
                    $('.menu').toggle('slow');
                    return false
                });
                $('.menu').click(function(event) {
                    var disallow = {"A": 1, "BUTTON": 1, "INPUT": 1};
                    var parnetTagName = $(event.target).parent()[0].tagName;
                    if (!(disallow[event.target.tagName] || disallow[parnetTagName])) {
                        $('.menu').toggle('slow');
                        return false
                    }
                    return true
                });

                // masonry
                var $container = $('#container');
                $container.imagesLoaded(function() {
                    $container.masonry({
                        itemSelector: '.brick'
                    });
                    $container.masonry('bindResize');
                });
            });
        </script>
    {% endblock %}
    {% block ga %}
        {% if not devel %}
            <script>
                var _gaq = _gaq || [];
                _gaq.push(['_setAccount', 'UA-8994922-1']);
                _gaq.push(['_trackPageview']);

                (function() {
                    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
                    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
                    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
                })();
            </script>
        {% endif %}
    {% endblock %}
</body>
</html>