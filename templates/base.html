<!DOCTYPE html>
<html lang="{{ language_code }}" manifest="/cache.appcache">
<head>
	<meta charset="utf-8"/>
	<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no"/>
	<meta name="apple-mobile-web-app-capable" content="yes"/>
	<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"/>
	<meta name="verify-v1" content="500ha7MSGCMgwkQG3S+CaeF1KzDLZB3Q9Ly5o+R7g5w="/>
	<meta name="keywords" content="gae, google appengine, google app engine, django, python, html5, andrejevic"/>
	{% block meta %}<meta name="date" content="2008-03-01"/>{% endblock %}
	<title>{% block title %}ANDрејевићи{% endblock %}</title>
	<link type="text/css" rel="stylesheet" href="/static/css/base.css"/>
	<link type="application/rss+xml" rel="alternate" href="/rss/photo.xml" title="{{ _('photo rss') }}" />
	<link type="application/rss+xml" rel="alternate" href="/rss/entry.xml" title="{{ _('entry rss') }}" />
	<link type="image/x-icon" rel="shortcut icon" href="/static/images/favicon.ico"/>
</head>
{% import "snippets/macros.html" as m %}
<body>
	{% block modals %}
	<div id="overlay" class="hide"></div>
	<div id="confirm" class="modal"></div>
	<div id="spinner" class="modal">{{ m.spinner() }}</div>
	{% endblock %}

    <nav class="menu">
        {% block tools %}
            <div id="forms">
                <form id="langs" action="/setlang" method="post">
                    {% for code, lang in all_languages %}
                        <button class="{% if code == language_code %}current{% endif %}"
                            type="submit" name="language" value="{{ code }}" title="{{ lang }}">{{ language(code) }}</button>
                    {% endfor %}
                </form>
                <form id="searchForm" action="/search" method="get">
                    <button type="submit">{{ _('search') }}</button>
                    <input type="text" name="find"/>
                </form>
            </div>
        {% endblock %}
        {% block nav %}{{ m.menu('') }}{% endblock %}

        {% if is_admin %}
            <a href="/admin/" title="{{ _('Administration') }}" class="Admin">{{ _('Administration') }}</a>
        {% endif %}
        {% if user %}
            <a href="/sign" class="Logout">{{ _('Logout') }}</a>
        {% else %}
            <a href="/sign" class="Login">{{ _('Sign in') }}</a>
        {% endif %}

        <p id="footer">© АNDS v.{{ version() }} 2008-{{ year() }}
            powered by <a href="http://code.google.com/appengine/">Google App Engine {{ gaesdk() }}</a>
            {% if user %}<br><strong>{{ user.nickname() }}</strong>{% endif %}
        </p>
    </nav>
    <header id="header">
        <h1><a href="{{ uri_for('start') }}" title="{{ _('Start') }}">ANDрејевићи</a></h1>
        <a class="icon-home icon-4x" href="{{ uri_for('start') }}" title="{{ _('Start') }}"></a>
        <a href="#" id="tools" class="icon-reorder icon-4x" title="{{ _('Tools') }}"></a>
        <nav class="paginator">{% block paging %}{% include 'snippets/paginator.html' %}{% endblock %}</nav>
    </header>
    <div id="main">{% block contents %}{% endblock %}</div>

    {% block scripts %}
        <script>
            kind = '{{ kind }}';
            token = '{{ token }}';
            scripts = [
                '//ajax.googleapis.com/ajax/libs/jquery/1.7/jquery.min.js',
                '/static/scripts/imagesloaded.min.js',
                '/static/scripts/jquery.masonry.min.js',
                '/static/scripts/jquery.highlight.js',
                '/static/scripts/urlify.min.js',
                '/static/scripts/jquery.autocomplete.js',
                '/static/scripts/common.min.js',
                '/static/scripts/base.min.js'];
            function deferred_load() {
                if (!scripts.length) return;
                var elm = document.createElement('script');
                elm.src = scripts.shift();
                elm.onload = function() {
                    if (!this.readyState || this.readyState == 'complete') {
                        deferred_load();
                    }
                }
                document.body.appendChild(elm);
            }
            window.addEventListener('load', function(evt) {
                window.applicationCache.addEventListener('updateready', function(evt) {
                    if (window.applicationCache.status == window.applicationCache.UPDATEREADY) {
                        window.location.replace(window.location.href);
                        window.history.go(-1);
                    }
                }, false);
            }, false);
        </script>
    {% endblock %}

    {% block ga %}
        {% if not devel %}
            <script>
                var _gaq = _gaq || [];
                _gaq.push(['_setAccount', 'UA-8994922-1']);
                _gaq.push(['_trackPageview']);
                (function() {
                    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
                    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
                    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
                })();
            </script>
        {% endif %}
    {% endblock %}
</body>
</html>