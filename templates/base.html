<!DOCTYPE html>
<!DOCTYPE html>
<html lang="{{ LANGUAGE_CODE }}">
<head>
	<meta charset="utf-8"/>
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, target-densitydpi=device-dpi"/>
	<meta name="apple-mobile-web-app-capable" content="yes"/>
	<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"/>
	<meta name="verify-v1" content="500ha7MSGCMgwkQG3S+CaeF1KzDLZB3Q9Ly5o+R7g5w="/>
	<meta name="keywords" content="gae, google appengine, google app engine, django, python, html5, andrejevic"/>
	{% block meta %}<meta name="date" content="2008-03-01"/>{% endblock %}
	<title>{% block title %}ANDрејевићи{% endblock %}</title>
	<link type="text/css" rel="stylesheet" href="/static/css/base.css"/>
	<link type="application/rss+xml" rel="alternate" href="/rss/photo.xml" title="{{ _('photo rss') }}" />
	<link type="application/rss+xml" rel="alternate" href="/rss/entry.xml" title="{{ _('entry rss') }}" />
	<link type="image/x-icon" rel="shortcut icon" href="/static/images/favicon.ico"/>
</head>
<body>
	{% block modals %}
	<div id="overlay" class="hide"></div>
	<div id="graph" class="modal"></div>
	<div id="confirm" class="modal"></div>
	<div id="spinner" class="modal">
		<div class="bar1"></div><div class="bar2"></div><div class="bar3"></div><div class="bar4"></div><div class="bar5"></div><div class="bar6"></div><div class="bar7"></div><div class="bar8"></div><div class="bar9"></div><div class="bar10"></div><div class="bar11"></div><div class="bar12"></div>
	</div>
	{% endblock %}

	<div id="max">
		<nav class="menu">
			<h1><a href="{{ uri_for('start') }}" title="{{ _('Start') }}">ANDрејевићи</a></h1>
			{% block tools %}
				<div id="forms">
					<form id="langs" action="/setlang" method="post">
						{% for code, lang in LANGUAGES %}
							<button class="{% if code == LANGUAGE_CODE %}current{% endif %}"
								type="submit" name="language" value="{{ code }}" title="{{ lang }}">{{ language(code) }}</button>
						{% endfor %}
					</form>
					<form id="searchForm" action="/search" method="get">
						<input type="text" name="find"/>
						<button type="submit">{{ _('search') }}</button>
					</form>
				</div>
			{% endblock %}

            {% import "snippets/macros.html" as m %}
            {% block nav %}{{ m.menu('') }}{% endblock %}

			{% if is_admin %}<a href="/admin/" title="{{ _('Administration') }}" class="Admin">{{ _('Administration') }}</a>{% endif %}
			{% if user %}<a href="/sign" class="Logout">{{ _('Logout') }}</a>
			{% else %}<a href="/sign" class="Login">{{ _('Sign in') }}</a>{% endif %}

			<p id="footer">© АNDS v.{{ version() }} 2008-{{ now() }}
				powered by <a href="http://code.google.com/appengine/">Google App Engine {{ gaesdk() }}</a>
				{% if user %}<br><strong>{{ user.nickname() }}</strong>{% endif %}
			</p>
		</nav>
		<header id="header">
			<h1><a href="{{ uri_for('start') }}" title="{{ _('Start') }}">ANDрејевићи</a></h1>
			<div id="tools">
				{% block paging %}<nav class="paginator">{% include 'snippets/paginator.html' %}</nav>{% endblock %}
				<a href="#" id="menu" title="{{ _('Tools') }}">✪</a>
			</div>
		</header>
		<div id="main">
			<aside id="aside">
				<nav class="submenu">{% block subnav %}{% endblock %}</nav>
				{% block aside %}{% endblock %}
			</aside>
			{% block contents %}{% endblock %}
		</div>
	</div>
    {% block scripts %}
        <script src="http://www.google.com/jsapi?autoload={'modules':[{name:'jquery',version:1},{name:'visualization',version:1,'packages':['corechart']}]}"></script>
        <script src="/static/scripts/jquery.isotope.min.js"></script>
        <script src="/static/scripts/common.js"></script>
        <script>
            $(function() {
                var $pinner = $('#overlay, #spinner');
                var kind = '{{ kind }}';
                var crumbs = location.pathname.split('/');
                crumbs.shift();
                crumbs.shift();

                if ('ontouchstart' in window) {
                    $(window).bind("load", setTimeout(function() {window.scrollTo(0, 1)}, 100));
                }
                $('a.graph').live('click', function() {
                    $('#spinner').show();
                    $('#graph').load(this.href, function() {
                        $('#overlay, #graph').show();
                        $('#spinner').hide();
                    });
                    return false
                })
                $('a.confirm').click(function() {
                    $('#confirm').load(this.href, function() {
                        $('#overlay, #confirm').show();
                    });
                    return false
                });
                $('#searchForm').submit(function() {
                    $pinner.show();
                });

                if (kind != '') {
                    $('.hide').hide();
                    $('.collapse').each(function() {
                        $(this).plus();
                    });

                    if (crumbs.length >= 2) {
                        var field = crumbs[0];
                        if (field == 'hue' || field == 'lum') field = 'colors';
                        var available = ['tags', 'date', 'author', 'colors', 'model', 'lens', 'eqv', 'iso', 'forkind'];
                        if ($.inArray(field, available) != -1) {
                            $.ajax({
                                url: '/filter/' + kind + '_' + field + '/' + crumbs[1],
                                context: $('#' + field + 'cloud'),
                                success: function(snippet) {
                                    $(this).html(snippet).slideDown();
                                    $('.' + field).minus();
                                }
                            });
                        }
                    }
                }

                $('.collapse').click(function() {
                    var cntx = $(this);
                    var url = cntx.attr('href');
                    var key = url.split('/').pop();
                    var field = key.split('_').pop();

                    $('.hide').slideUp();
                    $('.collapse').each(function() {
                        $(this).plus();
                    });

                    $pinner.show();
                    if (crumbs[0] == field && crumbs[1] != undefined) url += '/' + crumbs[1];
                    $.ajax({
                        url: url,
                        context: $('#' + field + 'cloud'),
                        success: function(snippet) {
                            $(this).html(snippet).slideDown();
                            cntx.minus();
                            $pinner.hide();
                        }
                    });
                    return false
                });

                $('#menu').click(function() {
                    $('.menu').toggle('slow');
                    return false
                });
                $('.menu').click(function(event) {
                    var disallow = {"A": 1, "BUTTON": 1, "INPUT": 1};
                    var parnetTagName = $(event.target).parent()[0].tagName;
                    if (!(disallow[event.target.tagName] || disallow[parnetTagName])) {
                        $('.menu').toggle('slow');
                        return false
                    }
                    return true
                });

                // isotope
                var $container = $('#container');
                function layouting() {
                    $container.isotope({
                        itemSelector: '.brick',
                        resizable: false,
                        fitColumns: true
                    });
                }
                $container.imagesLoaded(function() {
                    layouting();
                    $(window).smartresize(layouting);
                });
            });
        </script>
    {% endblock %}
    {% block ga %}
        {% if not devel %}
            <script>
                var _gaq = _gaq || [];
                _gaq.push(['_setAccount', 'UA-8994922-1']);
                _gaq.push(['_trackPageview']);

                (function() {
                    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
                    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
                    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
                })();
            </script>
        {% endif %}
    {% endblock %}
</body>
</html>