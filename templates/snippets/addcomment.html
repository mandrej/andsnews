<div class="popup dummy">
	<h4>{{ _('Add comment') }}</h4>
	<a class="button close" title="{{ _('close') }}">{{ _('close') }}</a>
	<div class="content">
		<h6>{{ _('for') }} {{ headline }}</h6>
		<form id="addcommentForm" action="" method="post">
			<fieldset>
                <p>
                    {{ form.email.label(class='required') }}
                    {{ form.email }}
                    <span class="error C_{{ form.email.name }}"><!-- -->{{ form.email.errors|join(', ') }}</span>
                </p>
                <p class="editor">
                    {{ form.body(rows=6) }}
                    <span class="error C_{{ form.body.name }}"><!-- -->{{ form.body.errors|join(', ') }}</span>
                </p>
			</fieldset>
			<p class="buttons">
				<button type="submit">{{ _('send') }}</button>
			</p>
		</form>
	</div>
</div>
<div class="popup info hide">
	<h4>{{ _('Thank you') }}</h4>
	<a class="button close" title="{{ _('close') }}">{{ _('close') }}</a>
	<div class="content">
		<p>{{ _('Your comment has been sent in deferred manner') }}.
			{{ _('It may take some time before site become aware of it') }}.<br/>
			{{ _('Thank you for your contribution') }}.</p>
	</div>
</div>
<script src="/static/scripts/markitup/jquery.markitup.pack.js"></script>
<script src="/static/scripts/markitup/sets/cmnt.set_{{ LANGUAGE_CODE }}.js"></script>
<link type="text/css" rel="stylesheet" href="/static/scripts/markitup/skins/simple/style.css"/>
<link type="text/css" rel="stylesheet" href="/static/scripts/markitup/sets/buttons.css"/>
<script>
$(function() {
	$('#body').markItUp(cmntSettings, {nameSpace: 'small'});
	$('.content button').click(function() {
        $.ajax({
            type: 'POST',
            url: '/comments/{{ safekey }}/add',
            data: {'email': $('#email').val(),
                   'body': $('#body').val()},
            dataType: 'json',
            success: function(data, status, xhr) {
                // console.log(data);
                if (data.success == true) {
                    $('.dummy').hide();
                    $('.info').show()
                    setTimeout(function() {
                        $('#overlay, #addcomment').hide();
                    }, 5000);
                } else {
                    $('.error').text('');
                    $.each(data, function(key, arr) {
                        $('.error.C_' + key).text(arr.join(', '));
                    });
                }
            }
        });
        return false
	});
});
</script>