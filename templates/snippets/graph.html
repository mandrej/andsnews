{% set titles = {
    'tags': _('Tags'), 'date': _('Dates'), 'author': _('Authors'), 'color': _('Color'), 'model': _('Camera model'),
    'lens': _('Lens type'), 'eqv': _('Eqv. focal length'), 'iso': _('Sensitivity')
} %}
<div class="popup">
    <h4>{{ titles[field_name] }}</h4>
    <a class="close fa fa-times-circle fa-2x" title="{{ _('close') }}"></a>
    <div class="content">
        <div id="chart"></div>
        {% if field_name == 'color' %}
            <p><a href="http://99designs.com/tech-blog/blog/2012/05/11/color-analysis/" target="_blank">
                {{ _('Based od colorific color extraction in CIE 2000 color space') }}</a>
            </p>
        {% elif field_name == 'eqv' %}
            <p>{{ _('Equivalent focal lengths are calculated for a full format sensor or 35 mm film camera, rounded to nearset 10') }}</p>
        {% endif %}
    </div>
</div>
<script>
    var field_name = '{{ field_name }}';
    var items = {{ items|to_json }};
    var chartOptions = {
        backgroundColor: 'transparent', pieSliceBorderColor: 'transparent',
        fontSize: 12, fontName: 'sans-serif',
        chartArea: {width: 420, top: 0, left: 0, height: 300},
        legend: {textStyle: {color: '#000'}}
    };

    var suffix, colors = [];
    var data = new google.visualization.DataTable();
    switch(field_name) {
        case 'eqv':
            suffix = ' mm'; break;
        case 'iso':
            suffix = ' ASA'; break;
        default:
            suffix = '';
    }
    data.addColumn('string', 'name');
    data.addColumn('number', 'count');

    $.each(items, function(i, item) {
        data.addRow([item.name + suffix, item.count]);
        if (item.hex) colors.push(item.hex);
    });
    var chart = new google.visualization.PieChart($('#chart')[0]);
    if (colors.length > 0) $.extend(chartOptions, {colors: colors});
    chart.draw(data, chartOptions);
    delete chartOptions['colors'];
</script>