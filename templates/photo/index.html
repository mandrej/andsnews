{% extends "photo/base.html" %}
{% import "snippets/macros.html" as m %}
{% block title %}{{ super() }} - {{ _('Photos') }}{% endblock %}
{% block paging %}{% endblock %}

{% block contents %}
<h2>
    <a href="{{ uri_for('photo_all') }}">{{ _('Photos') }}</a>
    {{ m.filter_title(filter) }}
</h2>

<div id="container">
    <div class="swiper-container">
        <div class="swiper-wrapper"></div>
    </div>
</div>
{% endblock %}

{% block scripts %}
    {{ super() }}
    <script src="/static/scripts/idangerous.swiper.min.js"></script>
    <script>
        $(function() {
            var endIndex = -1;
            var mySwiper = new Swiper('.swiper-container', {
                speed: 500,
                loop: false,
                grabCursor: true,
                calculateHeight: true,
                keyboardControl: true,
                watchActiveIndex: true,
                onTouchStart: appendSlide,
                onSlideNext: appendSlide
            });
            function appendSlide(swiper) {
                var lastIndex, lastSlide = swiper.getLastSlide();
                if (lastSlide == undefined) {
                    lastIndex = 0;
                } else {
                    lastIndex = 1 * lastSlide.data('index');
                }
                if (endIndex == lastIndex) return;
                var xhr = $.get('?page=' + ++lastIndex)
                    .done(function(data) {
{#                        console.log(data);#}
                        var newSlide = swiper.createSlide(data);
                        newSlide.data('index', lastIndex);
                        newSlide.append();
                        swiper.reInit();
                        if (swiper.slides.length == 1) {
                            appendSlide(swiper);
                        }
                    })
                    .fail(function() {
                        endIndex = lastIndex - 1;
                    });
            }
            appendSlide(mySwiper);
        });
    </script>
{% endblock %}