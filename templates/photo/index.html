{% extends "photo/base.html" %}
{% import "snippets/macros.html" as m %}
{% block title %}{{ super() }} - {{ _('Photos') }}{% endblock %}
{% block paging %}
    {% with name='photo_all' %}{% include 'snippets/paging.html' %}{% endwith %}
{% endblock %}

{% block contents %}
    <div class="swiper-container swiper-parent">
        <div class="swiper-wrapper">
            {% for object in objects %}
                {% if object %}
                    <div class="swiper-slide main">
                        <div class="cover lazyload" data-bg="{{ object.normal_url }}">
                            <div class="swiper-container swiper-nested">
                                <div class="swiper-wrapper">
                                    <div class="swiper-slide blank"></div>
                                    <div class="swiper-slide exif">
                                        {% include "photo/exif.html" %}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                {% endif %}
            {% endfor %}
        </div>
    </div>
{% endblock %}

{% block scripts %}
    {{ super() }}
    <script>
        $(function () {
            var horizontal = $('.swiper-parent').swiper({
                mode: 'horizontal',
                keyboardControl: true,
                watchActiveIndex: true,
                onSlideChangeEnd: function(sw, direction) {
                    var href = $('.next').attr('href'),
                        slide = sw.activeSlide();

                    if (href && num - slide.index() == 3 && direction == 'next') {
                        $.get(href, function(page) {
                            var nav = $(page).find('nav.paginator'),
                                slides = $(page).find('.main');

                            $.each(slides, function(i, slide) {
                                sw.appendSlide(slide);
                            });
                            $('nav.paginator').html(nav);
                            num = sw.slides.length;
                            vertical = $('.swiper-nested').swiper({
                                mode: 'vertical',
                                keyboardControl: true
                            })
                        })
                    }
                }
            });
            var vertical = $('.swiper-nested').swiper({
                mode: 'vertical',
                keyboardControl: true
            });
            var num = horizontal.slides.length;
            $('nav.paginator').hide();

            $(document).on('lazybeforeunveil', function(e) {
                var $this = $(e.target);
                var url = $this.data('bg');
                if (url) $this.css('background-image', 'url(' + url + ')').removeAttr('data-bg');
            });
        });
    </script>
{% endblock %}

{#{% block contents %}#}
{#    <div id="gallery">#}
{#        <div class="filters">#}
{#            <h2>{{ _('Filter') }}#}
{#                <span>{{ m.filter_title(filter) }}</span>#}
{#            </h2>#}
{#            <div id="links">#}
{#                {% set _tags = {'field': 'tags', 'title': _('Tags')} %}#}
{#                {% set _date = {'field': 'date', 'title': _('Dates')} %}#}
{#                {% set _author = {'field': 'author', 'title': _('Authors')} %}#}
{#                {% set _color = {'field': 'color', 'title': _('Color')} %}#}
{#                {% set _model = {'field': 'model', 'title': _('Camera model')} %}#}
{#                {% set _lens = {'field': 'lens', 'title': _('Lens type')} %}#}
{#                {% set _eqv = {'field': 'eqv', 'title': _('Eqv. focal length')} %}#}
{#                {% set _iso = {'field': 'iso', 'title': _('Sensitivity')} %}#}
{##}
{#                {% for f in [_tags, _date, _author, _color, _model, _lens, _eqv, _iso] %}#}
{#                    <a class="{{ f.field }} block collapse" href="/filter/Photo_{{ f.field }}">{{ f.title }} [+]</a>#}
{#                    <div id="{{ f.field }}cloud" class="hide"></div>#}
{#                {% endfor %}#}
{#            </div>#}
{#        </div>#}
{#    </div>#}
{#{% endblock %}#}
