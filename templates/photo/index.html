{% extends "photo/base.html" %}
{% import "snippets/macros.html" as m %}
{% block title %}{{ super() }} - {{ _('Photos') }}{% endblock %}

{% block contents %}
<aside>
    <nav class="submenu">
        <h2>
            {% if user %}
                <a href="{{ uri_for('photo_add') }}" class="add" title="{{ _('Add') }}">{{ _('Add') }}</a>
            {% endif %}
        </h2>
    </nav>
</aside>
<h2>
    <a href="{{ uri_for('photo_all') }}">{{ _('Photos') }}</a>
    {{ m.filter_title(filter) }}
    {{ m.page_number(page) }}
</h2>

<div id="container">
    {% for object in objects %}
        {% if object %}
            {% if filter %}
                {% set url = uri_for('photo_filter', field = filter.field, value = filter.value, slug = object.key.string_id()) %}
            {% else %}
                {% set url = uri_for('photo', slug = object.key.string_id()) %}
            {% endif %}
            <figure class="thumbnail brick">
                <a href="{{ url }}?idx={{ idx + loop.index }}" title="{{ object.headline }}">
                    <img src="{{ object.small_url }}"/>
                    <p class="legend">{{ object.headline }}</p>
                </a>
            </figure>
        {% endif %}
    {% else %}
        <section class="third">
            <div class="box">
                <h3>{{ _('No photos submitted') }}, {{ _('or filter has no results') }}.</h3>
            </div>
        </section>
    {% endfor %}
</div>
{% endblock %}
{% block scripts %}
    {{ super() }}
    <script>
        nbl.l([[
            'https://ajax.googleapis.com/ajax/libs/jquery/1.7/jquery.min.js', [
                '/static/scripts/imagesloaded.min.js',
                '/static/scripts/jquery.masonry.min.js', [
                    '/static/scripts/common.min.js',
                    '/static/scripts/base.min.js',
                    function() {done()}]]]]);
        function done() {
           var $container = $('#container');
            $container.imagesLoaded(function() {
                $container.masonry({
                    itemSelector: '.brick'
                });
                $container.masonry('bindResize');
            });
        }
    </script>
{% endblock %}