{% extends "base.html" %}
{% import "snippets/macros.html" as m %}
{% set kind='Photo' %}
{% block nav %}{{ m.menu(kind, user, is_admin) }}{% endblock %}

{% block scripts %}
    {{ super() }}
    <script src="/static/scripts/jquery.history.min.js"></script>
    <script src="/static/scripts/idangerous.swiper.min.js"></script>
    <script>
         $(function() {
            var prefix = 'ANDрејевићи - ';
            var History = window.History;
            History.options.disableSuid = true;

            function drawCanvas(slide) {
                var canvas = slide.find('canvas');
                if (canvas.length) {
                    if (canvas.attr('width') == undefined) {
                        var normal_url = $(canvas).data('url');
                        canvas.copyright(normal_url);
                        $(window).resize(function() {
                            canvas.copyright(normal_url);
                        });
                    }
                }
            }

            function push_state() {
                var slide = $(mySwiper.activeSlide());
                var params = slide.data();
                History.pushState(null, prefix + params.title, params.page);
                drawCanvas(slide);
            }
            var mySwiper = new Swiper('.swiper-container', {
                speed: 500,
                loop: false,
                grabCursor: true,
                keyboardControl: true,
                watchActiveIndex: true,
                preventLinksPropagation: true,
                onSlideChangeEnd: function(swiper, direction) {
                    push_state();
                }
            });

            History.Adapter.bind(window, 'statechange', function() {
                var State = History.getState();
                var current = mySwiper.activeIndex;
                var index = $.inArray(State.hash, pages);
                if (index > current) {
                    mySwiper.swipeNext();
                } else if (index < current) {
                    mySwiper.swipePrev();
                }
			});

            var pages = $.map($('.swiper-slide'), function(item) {
               return item.data('page')
            });
            var start = $.inArray(location.pathname, pages);
            if (start != - 1) {
                mySwiper.swipeTo(start, 0, false);
                drawCanvas($(mySwiper.activeSlide()));
            }
         });
    </script>
{% endblock %}
