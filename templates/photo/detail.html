{% extends "photo/base.html" %}
{% import "snippets/macros.html" as m %}

{% block title %}{{ super() }} - {{ object.headline }}{% endblock %}
{% block meta %}<meta name="date" content="{{ object.date|to_date }}"/>{% endblock %}

{% block modals %}
{{ super() }}
<div id="addcomment" class="modal"></div>
{% endblock %}

{% block paging %}
    {% if previous or next %}
        {% if previous %}
            {% set url = uri_for('photo_filter', field=filter.field, value=filter.value, slug=previous.key.string_id())
                if filter else uri_for('photo', slug=previous.key.string_id()) %}
            <a{{ {'href': url, 'class': prev_class, 'title': previous.headline}|xmlattr }}></a>
        {% else %}
            <span class="{{ prev_class }} na"></span>
        {% endif %}
        {% if next %}
            {% set url = uri_for('photo_filter', field=filter.field, value=filter.value, slug=next.key.string_id())
                if filter else uri_for('photo', slug=next.key.string_id()) %}
            <a{{ {'href': url, 'class': next_class, 'title': next.headline}|xmlattr }}></a>
        {% else %}
            <span class="{{ next_class }} na"></span>
        {% endif %}
    {% endif %}
{% endblock %}

{% block contents %}
{% if filter %}
    {% set url = uri_for('photo_filter_all', field=filter.field, value=filter.value) %}
{% else %}
    {% set url = uri_for('photo_all') %}
{% endif %}
<h2>
    <a href="{{ url }}"> {{ _('Photos') }}
        {{ m.filter_title(filter) }}
    </a>
    / {{ object.headline }}
</h2>
<p class="subtitle">
    <i class="fa fa-user"></i>
    <a href="{{ uri_for('photo_filter_all', field='author', value=object.author) }}"
        title="{{ _("author's photos") }}">{{ object.author }}</a>
    {% for tag in object.tags %}
        {% if loop.first %}<i class="fa fa-tags"></i>{% endif %}
        <a href="{{ uri_for('photo_filter_all', field='tags', value=tag) }}">
            {{ tag }}</a>{% if not loop.last %},{% endif %}
    {% endfor %}
    <i class="fa fa-clock-o"></i>
    <a href="{{ uri_for('photo_filter_all', field='date', value=object.year) }}"
        title="{{ _('photos taken same year') }}">{{ object.year }}</a>
</p>

<div id="container" class="port">
    <article>
        <canvas></canvas>
    </article>
    <aside>
        {% include "photo/exif.html" %}
        <div id="comments">
            {% for comment in object.comment_list() %}
                {{ m.render_comment(comment, user) }}
            {% endfor %}
        </div>
        {% if user %}
            <h3><a class="comment_add block button" href="{{ uri_for('comment_add', safe_key=object.key.urlsafe()) }}">
                <i class="fa fa-comment"></i> {{ _('Add Comment') }}</a></h3>
            <h3><a class="block button" href="{{ uri_for('download', safe_key=object.key.urlsafe()) }}">
                <i class="fa fa-download"></i> {{ _('Download') }} ({{ object.size|filesizeformat }})</a></h3>
        {% endif %}
        {% if is_admin or user == object.author %}
            <h3><a class="block button" href="{{ uri_for('photo_edit', slug=object.key.string_id()) }}">
                <i class="fa fa-pencil-square"></i> {{ _('Edit') }}</a></h3>
        {% endif %}
    </aside>
</div>
{% endblock %}
{% block scripts %}
    {{ super() }}
    <link type="text/css" rel="stylesheet" href="/static/scripts/markitup/skins/simple/style.css"/>
    <link type="text/css" rel="stylesheet" href="/static/scripts/markitup/sets/buttons.css"/>
    <script src="/static/scripts/jquery.searchhighlight.min.js"></script>
    <script src="/static/scripts/markitup/jquery.markitup.min.js"></script>
    <script src="/static/scripts/markitup/sets/cmnt.set_{{ language_code }}.min.js"></script>
    <script>
        $(function () {
            var normal_url = '{{ object.normal_url_async.get_result() }}';
            $('canvas').copyright(normal_url);
            $(window).resize(function() {
                $('canvas').copyright(normal_url);
            });
        });
    </script>
{% endblock %}