{% extends "photo/base.html" %}
{% import "snippets/macros.html" as m %}
{% block paging %}{% endblock %}

{% block title %}{{ super() }} - {{ object.headline }}{% endblock %}
{% block meta %}<meta name="date" content="{{ object.date|to_date }}"/>{% endblock %}

{% block modals %}
{{ super() }}
<div id="addcomment" class="modal"></div>
{% endblock %}

{% block contents %}
<div id="container">
    <div class="swiper-container">
        <div class="swiper-wrapper"></div>
    </div>
</div>
{% endblock %}

{% block scripts %}
    {{ super() }}
    <link type="text/css" rel="stylesheet" href="/static/scripts/markitup/skins/simple/style.css"/>
    <link type="text/css" rel="stylesheet" href="/static/scripts/markitup/sets/buttons.css"/>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.0/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-migrate/1.2.1/jquery-migrate.js"></script>
    <script src="/static/scripts/base.min.js"></script>
    <script src="/static/scripts/jquery.searchhighlight.min.js"></script>
    <script src="/static/scripts/markitup/jquery.markitup.min.js"></script>
    <script src="/static/scripts/markitup/sets/cmnt.set_{{ language_code }}.min.js"></script>
    <script src="/static/scripts/idangerous.swiper.min.js"></script>
    <script>
        $(function() {
            var endIndex = -1;
            var mySwiper = new Swiper('.swiper-container', {
                speed: 500,
                loop: false,
                grabCursor: true,
                calculateHeight: true,
                keyboardControl: true,
                watchActiveIndex: true,
                onTouchStart: appendSlide,
                onSlideNext: appendSlide
            });
            function appendSlide(swiper) {
                var lastIndex, lastSlide = swiper.getLastSlide();
                if (lastSlide == undefined) {
                    lastIndex = 0;
                } else {
                    lastIndex = 1 * lastSlide.data('index');
                }
                if (endIndex == lastIndex) return;
                var xhr = $.get('{{ next_url }}')
                    .done(function(data) {
                        var newSlide = swiper.createSlide(data);
                        newSlide.data('index', lastIndex);
                        newSlide.append();
                        swiper.reInit();
                        if (swiper.slides.length == 1) {
                            appendSlide(swiper);
                        }
                    })
                    .fail(function() {
                        endIndex = lastIndex - 1;
                    });
            }
            appendSlide(mySwiper);
        });
    </script>
{% endblock %}