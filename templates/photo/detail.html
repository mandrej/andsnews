{% extends "photo/base.html" %}

{% block title %}{{ super() }} - {{ object.headline }}{% endblock %}
{% block meta %}<meta name="date" content="{{ object.date|format_date }}"/>{% endblock %}

{% block subnav %}
    {% if user %}
        <a href="{{ uri_for('photo_add') }}" class="add" title="{{ _('Add') }}">{{ _('Add') }}</a>
    {% endif %}
    {% if is_admin or user == object.author %}
        <a href="{{ uri_for('photo_edit', slug=object.key.string_id()) }}" class="change" title="{{ _('Edit') }}">{{ _('Edit') }}</a>
        <a class="confirm" href="{{ uri_for('delete', safekey=object.key.urlsafe()) }}" title="{{ _('Delete') }}">{{ _('Delete') }}</a>
    {% endif %}
    <a class="comment_add" href="{{ uri_for('comment_add', safekey=object.key.urlsafe()) }}" title="{{ _('Comment') }}">{{ _('Comment') }}</a>
    <a href="{{ uri_for('photos') }}" title="{{ _('Back') }}">{{ _('Back') }}</a>
{% endblock %}

{% block modals %}
{{ super() }}
<div id="addcomment" class="modal"></div>
{% endblock %}

{% block paging %}
	{% if previous or next %}
	<nav class="paginator">
	    {% if previous %}
			<a class="prev" href="{{ uri_for('photos') }}{{ filter_url }}{{ idx - 1 }}"
				title="{{ previous.headline }}">◀</a>
	    {% else %}
	        <span class="prev na">◀</span>
	    {% endif %}
	    {% if next %}
			<a class="next" href="{{ uri_for('photos') }}{{ filter_url }}{{ idx + 1 }}"
				title="{{ next.headline }}">▶</a>
	    {% else %}
	        <span class="next na">▶</span>
	    {% endif %}
	</nav>
	{% endif %}
{% endblock %}

{% block aside %}
	{% include "photo/exif.html" %}
	<div id="comments">{% include "comment/detail.html" %}</div>
{% endblock %}

{% block contents %}
<article>
	<header>
		<h2>{% if filter %}
				<a href="{{ uri_for('photos') }}{{ filter_url }}?page={{ page }}">{{ _('Photos') }} {{ filter_title }}</a>
			{% else %}
				<a href="{{ uri_for('photos') }}?page={{ page }}">{{ _('Photos') }}</a>
			{% endif %}
			/ {{ object.headline }}{% if idx %} [{{ idx }}]{% endif %}</h2>
		
		<div class="subtitle">
			<a href="{{ uri_for('photos') }}author/{{ object.author }}/"
				title="{{ _('author&apos;s photos') }}">{{ object.author }}</a>
			{% for tag in object.tags %}
				{% if loop.first %}| {{ _('tagged by') }}:{% endif %}
				<a href="{{ uri_for('photos') }}tags/{{ tag }}/" title="{{ tag }}">
					{{ tag }}</a>{% if not loop.last %},{% endif %}
			{% endfor %}
			| <a href="{{ uri_for('photos') }}date/{{ object.year }}/"
				title="{{ _('photos taken same year') }}">{{ object.year }}</a>
		</div>
	</header>
	
	<figure id="port">
        <img src="{{ object.normal_url() }}" alt="{{ object.headline }}"/>
	</figure>
</article>
{% endblock %}

{% block scripts %}
    {{ super() }}
    <script src="/static/scripts/jquery.highlight.js"></script>
    <script>
        $(function() {
            var match = location.search.match(/find=([^&]+)/i);
            if (match) {
                $(function() {
                    var options = {exact: "partial", highlight: "#main",
                        keys: decodeURIComponent(match[1])};
                    $(document).SearchHighlight(options);
                });
            }
            $('a.comment_add').click(function() {
                $('#addcomment').load(this.href, function() {
                    $('#overlay, #addcomment').show();
                });
                return false
            });
        });
    </script>
{% endblock %}