{% extends "base.html" %}
{% block nav %}
    <ul class="fa-ul">
        <li><a href="{{ uri_for('photo_all', page=1) }}" title="{{ _('Photos') }}"><i class="fa fa-camera"></i></a></li>
        <li><a href="{{ uri_for('entry_all', page=1) }}" title="{{ _('Blog') }}"><i class="fa fa-file-text"></i></a></li>
        <li><a href="{{ uri_for('comment_all', page=1) }}" title="{{ _('Comments') }}"><i class="fa fa-comment"></i></a></li>
        <li><a href="{{ uri_for('feed_all', page=1) }}" title="{{ _('News') }}"><i class="fa fa-rss-square"></i></a></li>
        {% if user %}
            <li class="active"><a href="/admin/" title="{{ _('Administration') }}"><i class="fa fa-cog"></i></a></li>
        {% else %}
            <li><a href="/sign" title="{{ _('Log in') }}"><i class="fa fa-sign-in"></i></a></li>
        {% endif %}
    </ul>

    {% if user %}
        <h3><a class="selected" href="{{ uri_for('admin_all') }}">{{ _('Administration') }}</a></h3>
        <div class="submenu">
            <a href="{{ uri_for('photo_admin', page=1) }}" class="block">Photo administration</a>
            <a href="{{ uri_for('entry_admin', page=1) }}" class="block">Entry administration</a>
            <a href="{{ uri_for('feed_admin') }}" class="block">Feed administration</a>
            <a href="{{ uri_for('comment_admin', page=1) }}" class="block">Comment &amp; message administration</a>
            {% if is_admin %}
                <a href="{{ uri_for('counter_admin', page=1) }}" class="block">Counters</a>
                <a href="/mapreduce" class="block">Mapreduce</a>
            {% endif %}
            <a href="/invalidate" class="block">{{ _('Invalidate cache') }}</a>
            <a href="/sign" class="block">{{ _('Log out') }}</a>
        </div>
    {% endif %}
{% endblock %}

{% block scripts %}
    {{ super() }}
    <script src="https://code.jquery.com/ui/1.11.1/jquery-ui.js"></script>
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.11.1/themes/smoothness/jquery-ui.css">
    <script>
        (function($) {
            function split(val) {
                return val.split(/,\s*/);
            }
            function extractLast(term) {
                return split(term).pop();
            }
            $.fn.multicomplete = function(options) {
                var defaults = {minLength: 2};
                var opts = $.extend({}, defaults, options);
                return this.each(function() {
                    $(this).bind('keydown', function(event) {
                        if (event.keyCode === $.ui.keyCode.TAB && $(this).autocomplete('instance').menu.active ) {
                            event.preventDefault();
                        }
                    }).autocomplete({
                        source: function(request, response) {
                            $.getJSON(opts.source, {
                                term: extractLast(request.term)
                            }, response);
                        },
                        search: function() {
                            var term = extractLast(this.value);
                            if (term.length < opts.minLength) {
                                return false;
                            }
                        },
                        focus: function(event, ui) {
                            return false;
                        },
                        select: function(event, ui) {
                            var terms = split(this.value);
                            terms.pop();
                            terms.push(ui.item.value);
                            terms.push('');
                            this.value = terms.join(', ');
                            return false;
                        }
                    });
                });
            };
        })(jQuery);
    </script>
{% endblock %}

{% block ga %}{% endblock %}
{% set caching=false %}