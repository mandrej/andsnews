{% extends "base.html" %}

{% block subnav %}<h2><a href="{{ uri_for('start') }}">{{ _('Start ') }}</a></h2>{% endblock %}
{% block aside %}{% endblock %}
{% block modals %}{% endblock %}

{% block contents %}
<article>
	{% if phrase %}
		<h2>{% trans count=number_found %}{{ count }} search result for {{ phrase }}{% pluralize %}{{ count }} search results for {{ phrase }}{% endtrans %}
            {% if page != 1 %} [{{ page }}]{% endif %}
        </h2>
	{% else %}
		<h2>{{ _('Nothing to search for') }}.</h2>
        <p>{{ _('Please try something') }}.</p>
	{% endif %}

    {% macro result(object) %}
        <div class="third brick">
            <div>
                {% if object.kind == 'Photo' %}
                    <i class="icon-picture icon-3x pull-left"></i>
                    <h3><a href="{{ object.link }}?find={{ phrase }}">
                        {{ object.headline }}</a>
                        {% if object.tags %}
                            <br>{{ _('tagged by') }}: {{ object.tags }}
                        {% endif %}
                    </h3>
                {% elif object.kind == 'Entry' %}
                    <i class="icon-file icon-3x pull-left"></i>
                    <h3><a href="{{ object.link }}?find={{ phrase }}">
                        {{ object.headline }}</a>
                        {% if object.tags %}
                            <br>{{ _('tagged by') }}: {{ object.tags }}
                        {% endif %}
                    </h3>
                {% elif object.kind == 'Comment' %}
                    {% if object.headline %}
                        <i class="icon-comment-alt icon-3x pull-left"></i>
                        <h3><a href="{{ object.link }}?find={{ phrase }}">
                            {{ object.headline }} ({{ _('comment') }})</a></h3>
                    {% else %}
                        <i class="icon-comment icon-3x pull-left"></i>
                        <h3>{{ _('message') }}</h3>
                    {% endif %}
                {% endif %}
                {{ object.body }}
                <p class="details">
                    <strong>{{ object.author }}</strong>,
                    <time datetime='{{ object.date|format_datetime }}'>
                        {{ object.date|format_date }}</time></p>
            </div>
        </div>
    {% endmacro %}

    <div id="container">
        {% for object in objects %}
            {{ result(object) }}
        {% else %}
            <section class="third brick">
                <div class="box orange">
                    <h3>{{ _('No search results for') }} {{ phrase }}.</h3>
                    <p>{{ _('Please try again') }}.</p>
                    {% if error %}
                        <p>{{ _('Error') }}: {{ error }}</p>
                    {% endif %}
                </div>
            </section>
        {% endfor %}
    </div>
</article>
{% endblock %}

{% block scripts %}
    {{ super() }}
    <script src="/static/scripts/jquery.highlight.js"></script>
    <script>
        $(function() {
            var match = location.search.match(/find=([^&]+)/i);
            if (match) {
                $(function(){
                    var options = {exact: "partial", highlight: "#main",
                        keys: decodeURIComponent(match[1])};
                    $(document).SearchHighlight(options);
                });
            }
        });
    </script>
{% endblock %}