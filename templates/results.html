{% extends "base.html" %}
{% block paging %}
    {% with name='search' %}{% include 'snippets/paging.html' %}{% endwith %}
{% endblock %}
{% block modals %}{% endblock %}

{% block contents %}
    <header class="admin">
        {% if phrase %}
            <h2>{% trans count=number_found %}{{ count }} search result for '{{ phrase }}'{% pluralize %}{{ count }} search results for '{{ phrase }}'{% endtrans %}</h2>
        {% else %}
            <h2>{{ _('Nothing to search for') }}.</h2>
            <p>{{ _('Please try something') }}.</p>
        {% endif %}
    </header>
    <div id="gallery">
        {% for future in futures %}
            {% with object=future.get_result() %}
                {% if object.kind == 'Photo' %}
                    <a href="{{ uri_for('photo', slug=object.key.string_id()) }}" class="found thumbnail" >
                        <img src="{{ object.serving_url }}=s400">
                        <div class="title">{{ object.headline }}</div>
                    </a>
                {% elif object.kind == 'Entry' %}
                    <a href="{{ uri_for('entry', slug=object.key.string_id()) }}" class="found blog">
                        <h3>{{ object.headline }}
                            <span>
                                {{ object.author }},<br>
                                {% trans since=object.date|timesince %}{{ since }} ago{% endtrans %}
                            </span>
                        </h3>
                        <p>{{ object.summary }}</p>
                    </a>
                {% endif %}
            {% endwith %}
        {% else %}
            <div class="found blog">
                {% if error %}
                    <h3>{{ _('Error') }}: {{ error }}</h3>
                {% else %}
                    <h3>{{ _('No search results for') }} {{ phrase }}.</h3>
                    <p>{{ _('Please try again') }}.</p>
                {% endif %}
            </div>
        {% endfor %}
    </div>
{% endblock %}

{% block scripts %}
    {{ super() }}
    <script>
        $(function () {
            var $container = $('#gallery');
            $container.gridalicious({
                selector: '.found',
                width: 240,
                gutter: 10
            });
            $container.infinitescroll({
                binder: $(window),
                itemSelector: '.found',
                nextSelector: '.next',
                navSelector: "nav.paginator",
                loading: { msg: $('#dummy') }
            }, function(data) {
                $container.gridalicious('append', data);
            });
        });
    </script>
{% endblock %}