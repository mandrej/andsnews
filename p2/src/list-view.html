<link rel="import" href="../bower_components/polymer/polymer-element.html">
<link rel="import" href="../bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="../bower_components/iron-list/iron-list.html">
<link rel="import" href="../bower_components/iron-resizable-behavior/iron-resizable-behavior.html">
<link rel="import" href="../bower_components/paper-card/paper-card.html">
<link rel="import" href="../bower_components/paper-button/paper-button.html">
<link rel="import" href="../bower_components/paper-button/paper-button.html">
<!-- <link rel="import" href="../bower_components/iron-image/iron-image.html"> -->

<dom-module id="list-view">
  <template>
     <style include="shared-styles">
      :host {
        display: block;
      }
      iron-list {
        flex: 1 1 auto;
      }
      paper-card {
        width: 100%;
        --paper-card-header-image: {
          height: 200px;
        }
        --paper-card-header-color: var(--light-primary-color);
        --paper-card-content: {
          padding : 12px;
        }
        --paper-card-actions: {
          padding : 12px;
        }
      }
      paper-button {
        margin: 8px 0;
      }
    </style>

     <app-drawer-layout fullbleed responsive-width="768px">
      <app-drawer swipe-open slot="drawer">
        <app-header fixed></app-header>
      </app-drawer>

      <app-header-layout>
        <app-header condenses reveals effects="resize-title blend-background waterfall" slot="header">
          <app-toolbar>
            <paper-icon-button icon="app:menu" drawer-toggle></paper-icon-button>
              <h4 condensed-title>[[value]]</h4>
            <paper-icon-button icon="app:search"></paper-icon-button>
          </app-toolbar>
          <app-toolbar>
            <h1 main-title>[[value]]</h1>
          </app-toolbar>
        </app-header>

        <iron-ajax url="[[_url(field, value)]]" last-response="{{data}}" auto></iron-ajax>

         <iron-list id="list" items="[[data.objects]]" as="rec" scroll-target="document">
          <template>
            <div>
              <paper-card
                heading="[[rec.headline]]"
                image="[[rec.serving_url]]=s0"
                alt="[[rec.headline]]"
                elevation="0">
                <div class="card-content layout horizontal justified wrap">
                  <paper-button on-tap="showView">View</paper-button>
                  <paper-button on-tap="">Edit</paper-button>
                </div>
                <div class="card-actions layout horizontal justified wrap">
                  <paper-button on-tap="applyFilter" data-field="date" data-field-value$="[[rec.year]]">[[rec.year]]</paper-button>
                  <template is="dom-repeat" items="[[rec.tags]]" as="tag">
                    <paper-button on-tap="applyFilter" data-field="tags" data-field-value$="[[tag]]">[[tag]]</paper-button>
                  </template>
                  <paper-button on-tap="applyFilter" data-field="model" data-field-value$="[[rec.model]]">[[rec.model]]</paper-button>
                  <paper-button on-tap="applyFilter" data-field="color" data-field-value$="[[rec.color]]">[[rec.color]]</paper-button>
                </div>
              </paper-card>
            </div>
          </template>
        </iron-list>
       </app-header-layout>
    </app-drawer-layout>
  </template>

  <script>
    class ListView extends Polymer.GestureEventListeners(Polymer.Element) {
      static get is() { return 'list-view'; }
      static get properties() {
        return {
          route: Object
        };
      }
      _url(field, value) {
        const rx = /^\/list/;
        if (rx.test(this.route.path)) {
          return ['/api/photo', field, value].join('/');
        }
      }
      showView(e) {
        // const el = this.$.list;
        // el.grid = false;
        // el.querySelectorAll('rec').forEach(function(element) {
        //   element.classList.add('full');
        // }, this); ;
        // el.dispatchEvent('iron-resize');
        // let el = e.target;
        // while ((el = el.parentElement) && !el.classList.contains('rec'));
        // console.log(el);

        // const img = el.querySelector('iron-image');
        // img.src = img.src.replace('=s400', '=s0');
        // img.style.width = '100%';
        // img.style.height = '100vh';
        // this.$.list.grid = false;
        // const animation = el.animate({
        //   opacity: [0, 1],
        //   transform: ['translateY(100%)', 'translateY(0)'],
        // }, {
        //   direction: 'normal',
        //   duration: 500,
        //   easing: 'ease-in-out', //'linear', a bezier curve, etc.
        //   iterations: 1,
        //   fill: 'forwards'
        // });
        this.set('route.path', ['/item', e.model.rec.safekey].join('/'));
      }
      applyFilter(e) {
        const target = e.target,
          field = target.dataset.field,
          value = target.dataset.fieldValue;
        this.set('route.path', ['/list', field, value].join('/'));
      }
    }

    window.customElements.define(ListView.is, ListView);
  </script>
</dom-module>
