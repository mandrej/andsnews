<link rel="import" href="../bower_components/polymer/polymer-element.html">
<link rel="import" href="../bower_components/img-pan-zoom/img-pan-zoom.html">

<dom-module id="item-view">
  <template>
    <style include="shared-styles iron-flex">
      :host {
        @apply --layout-vertical;
        @apply --layout-fit;
        margin: 64px auto 0 auto;
        max-width: var(--max-width);
      }
      .container {
        @apply --layout-flex;
        margin: 0 calc(-1 * var(--user-gap));
        padding: var(--user-gap);
      }
      img-pan-zoom {
        height: 100%;
        box-sizing: border-box;
        --img-pan-zoom-spinner-color: var(--default-primary-color);
        --img-pan-zoom-spinner-width: 3px;
      }
      @media (max-width: 1024px) { .container { margin: 0; }}
      @media (min-width: 1025px) { .container { margin: 0; }}
    </style>

    <iron-ajax url="[[_url(safekey)]]" last-response="{{item}}" auto></iron-ajax>

    <app-header fixed slot="header">
      <app-toolbar>
        <paper-icon-button icon="arrow-back" on-tap="goBack"></paper-icon-button>
        <h1 main-title>[[item.headline]]</h1>
        <a href="/api/download/[[item.safekey]]" download="[[item.slug]].jpg" target="_blank">
          <paper-icon-button icon="file-download"></paper-icon-button>
        </a>
      </app-toolbar>
    </app-header>

    <div class="container">
      <img-pan-zoom src="[[checkImage(item)]]"
        visibility-ratio="1.0"
        max-zoom-pixel-ratio="1.0"></img-pan-zoom>
    </div>
  </template>

  <script>
    class ItemView extends Polymer.Element {
      static get is() { return 'item-view'; }
      _url(safekey) {
        const rx = /^\/item/;
        if (rx.test(this.route.path)) {
          return ['/api', safekey].join('/');
        }
      }
      checkImage(rec) {
        if (rec && rec.serving_url) return rec.serving_url + '=s0';
      }
      goBack() {
        window.history.go(-1);
      }
    }

    window.customElements.define(ItemView.is, ItemView);
  </script>
</dom-module>
