<link rel="import" href="../bower_components/polymer/polymer-element.html">
<link rel="import" href="../bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="../bower_components/iron-image/iron-image.html">

<dom-module id="item-view">
  <template>
    <style include="shared-styles">
       :host {
        display: block;
      }
      iron-image {
        width: 100%;
        height: 100vh;
      }
    </style>

    <app-drawer-layout fullbleed responsive-width="768px">
      <app-drawer swipe-open slot="drawer">
        <app-header fixed></app-header>
      </app-drawer>

      <app-header-layout>
        <app-header condenses fixed effects="resize-title blend-background waterfall" slot="header">
          <app-toolbar>
            <paper-icon-button icon="app:chevron-left"></paper-icon-button>
            <h4 condensed-title>[[data.headline]]</h4>
            <paper-icon-button icon="app:more-vert"></paper-icon-button>
          </app-toolbar>
          <app-toolbar>
            <h1 main-title>[[data.headline]]</h1>
          </app-toolbar>
        </app-header>

        <iron-ajax url="[[_url(safekey)]]" last-response="{{data}}" auto></iron-ajax>
        <iron-image src="[[data.serving_url]]=s0" preload fade sizing="cover"></iron-image>
      </app-header-layout>
    </app-drawer-layout>
  </template>

  <script>
    class ItemView extends Polymer.GestureEventListeners(Polymer.Element) {
      static get is() { return 'item-view'; }
      _url(safekey) {
        const rx = /^\/item/;
        if (rx.test(this.route.path)) {
          return ['/api', safekey].join('/');
        }
      }
    }

    window.customElements.define(ItemView.is, ItemView);
  </script>
</dom-module>
