<link rel="import" href="../bower_components/vaadin-material-theme/vaadin-button.html">
<link rel="import" href="../bower_components/vaadin-upload/vaadin-upload.html">

<dom-module id="vaadin-upload-style" theme-for="vaadin-upload">
  <template>
    <style include="iron-flex">
      :host {
        color: var(--text-primary-color);
      }
      [part="drop-label"] {
        @apply --layout-center;
      }
      [part="upload-button"] {
        color: var(--text-primary-color);
        background-color: var(--default-primary-color);
        @apply --shadow-elevation-2dp;
      }
      [part="file-list"] {
        padding: calc(var(--user-gap) / 2);
      }
    </style>
  </template>
</dom-module>

<dom-module id="add-view">
  <template>
    <style include="shared-styles iron-flex">
      :host {
        @apply --layout-vertical;
        @apply --layout-fit;
        margin: 64px auto 0 auto;
        max-width: var(--max-width);
      }
      .container {
        @apply --layout-flex;
        margin: var(--user-gap) calc(-1 * var(--user-gap)) 0;
        padding: var(--user-gap);
      }
      @media (max-width: 1200px) { .container { margin: 0; }}
    </style>

    <app-localstorage-document key="state" data="{{state}}"></app-localstorage-document>

    <app-header fixed slot="header">
      <app-toolbar>
        <paper-icon-button icon="arrow-back" on-tap="goBack"></paper-icon-button>
        <h1 main-title>Add</h1>
      </app-toolbar>
    </app-header>

    <paper-toast id="toast"></paper-toast>

    <div class="container">
      <div hidden$="[[!state.isAuthorized]]">
        <vaadin-upload id="upload"
          target="/api/photo/add"
          max-files="10"
          on-upload-response="_uploadResponse"
          accept="image/*">
          <iron-icon slot="drop-label-icon" icon="cloud-upload"></iron-icon>
          <span slot="drop-label">&nbsp;Drop files to the cloud&hellip;</span>
        </vaadin-upload>
        <p>See <a href="/list/tags/new">new uploaded files</a> and continue editing.</p>
      </div>
      <div hidden$="[[state.isAuthorized]]">
        <h2>Authorization Required</h2>
        <p>Go <a href="/list/all">Home</a> and Sign-In with your Google Account</p>
      </div>
    </div>
    <footer class="footer"><app-toolbar><h4 condensed-title>[[copy]]</h4></app-toolbar></footer>
  </template>

  <script>
    class AddView extends Polymer.Element {
      static get is() { return 'add-view'; }
      _uploadResponse(e) {
        const res = e.detail.xhr.response,
          toast = this.$.toast;
        if (res.success) {
          toast.setAttribute('text', 'Image successfully uploaded');
          this.dispatchEvent(new CustomEvent('current', {bubbles: true, composed: true, detail: res.rec}));
          toast.open();
        } else {
          toast.setAttribute('text', res.message);
          toast.open();
        }
      }
      goBack() {
        window.history.back();
      }
    }
    window.customElements.define(AddView.is, AddView);
  </script>
</dom-module>
